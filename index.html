<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BlackTrigger HQ</title>
  <link rel="manifest" href="/manifest.json">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <script src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #1a1a1a;
      color: #e0e0e0;
    }
    .module {
      margin-bottom: 20px;
      padding: 15px;
      background: #2a2a2a;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.5);
    }
    h2 { margin-top: 0; color: #00b7ff; }
    input, select, button {
      padding: 8px;
      margin: 5px;
      border-radius: 3px;
      border: 1px solid #444;
      background: #333;
      color: #e0e0e0;
    }
    button { background: #007bff; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
    ul { list-style: none; padding: 0; }
    li { padding: 10px; border-bottom: 1px solid #444; display: flex; justify-content: space-between; align-items: center; }
    .error { color: #ff4444; font-size: 0.8em; }
    .profile-card { display: flex; align-items: center; padding: 10px; border: 1px solid #444; margin-bottom: 10px; }
    .collapsible { display: none; }
    .collapsible.active { display: block; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); justify-content: center; align-items: center; }
    .modal-content { background: #2a2a2a; padding: 20px; border-radius: 5px; max-width: 90%; max-height: 90%; overflow-y: auto; color: #e0e0e0; }
    .modal.active { display: flex; }
    canvas { max-width: 100%; background: #2a2a2a; padding: 10px; border-radius: 5px; }
    .finance-container { display: flex; justify-content: space-between; }
    .finance-column { width: 48%; }
    .strategy-tree { display: flex; flex-direction: column; align-items: center; }
    .strategy-node { padding: 10px; border: 1px solid #444; margin: 5px; border-radius: 5px; }
    .strategy-branch { display: flex; justify-content: space-around; width: 100%; }
    #network { height: 300px; border: 1px solid #444; border-radius: 5px; }
    #rule-of-day { font-size: 1.2em; font-weight: bold; color: #00ff00; }
  </style>
</head>
<body>
  <div class="module">
    <button onclick="initEruda()">–û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å</button>
  </div>

  <!-- –ü—Ä–∞–≤–∏–ª–æ –¥–Ω—è -->
  <div class="module" id="rule-module">
    <h2>–ü—Ä–∞–≤–∏–ª–æ –¥–Ω—è</h2>
    <div id="rule-of-day"></div>
    <button onclick="updateRuleOfDay()">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ</button>
    <div class="error" id="rule-error"></div>
  </div>

  <!-- –°–ø—Ä–∞–≤–∫–∞ -->
  <div class="module" id="reference-module">
    <h2>–°–ø—Ä–∞–≤–∫–∞: –ö–æ–¥–µ–∫—Å –Ø–¥—Ä–∞</h2>
    <input type="text" id="reference-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–æ–¥–µ–∫—Å—É">
    <div id="reference-content"></div>
    <div class="error" id="reference-error"></div>
  </div>

  <!-- –ü–ª–∞–Ω –¥–Ω—è -->
  <div class="module" id="plan-module">
    <h2>–ü–ª–∞–Ω –¥–Ω—è</h2>
    <input type="text" id="plan-text" placeholder="–ó–∞–¥–∞—á–∞">
    <select id="plan-priority">
      <option value="low">–ù–∏–∑–∫–∏–π</option>
      <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
      <option value="high">–í—ã—Å–æ–∫–∏–π</option>
    </select>
    <button onclick="addPlan()">–î–æ–±–∞–≤–∏—Ç—å</button>
    <ul id="plan-list"></ul>
    <div class="error" id="plan-error"></div>
  </div>

  <!-- –û–∫—Ä—É–∂–µ–Ω–∏–µ -->
  <div class="module" id="environment-module">
    <h2>–û–∫—Ä—É–∂–µ–Ω–∏–µ</h2>
    <input type="text" id="person-name" placeholder="–ò–º—è —á–µ–ª–æ–≤–µ–∫–∞">
    <select id="person-status">
      <option value="loyal">–õ–æ—è–ª—å–Ω—ã–π</option>
      <option value="neutral">–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π</option>
      <option value="hostile">–í—Ä–∞–∂–¥–µ–±–Ω—ã–π</option>
    </select>
    <select id="person-tags" multiple>
      <option value="üí∞ –†–µ—Å—É—Ä—Å">üí∞ –†–µ—Å—É—Ä—Å</option>
      <option value="ü™® –ë–∞–ª–ª–∞—Å—Ç">ü™® –ë–∞–ª–ª–∞—Å—Ç</option>
      <option value="üß† –í–Ω—É—à–∞–µ–º—ã–π">üß† –í–Ω—É—à–∞–µ–º—ã–π</option>
      <option value="üó£Ô∏è –ë–æ–ª—Ç—É–Ω">üó£Ô∏è –ë–æ–ª—Ç—É–Ω</option>
      <option value="üß© –ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä">üß© –ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä</option>
    </select>
    <input type="number" id="person-karma" placeholder="–ö–∞—Ä–º–∞ (0)" value="0">
    <select id="person-connections" multiple>
      <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤—è–∑–∏</option>
    </select>
    <button onclick="addPerson()">–î–æ–±–∞–≤–∏—Ç—å</button>
    <div class="error" id="environment-error"></div>
    <ul id="person-list"></ul>
    <div id="network"></div>
  </div>

  <!-- –§–∏–∑–æ -->
  <div class="module" id="fitness-module">
    <h2>–§–∏–∑–æ</h2>
    <input type="text" id="exercise-type" placeholder="–¢–∏–ø (–Ω–∞–ø—Ä., –û—Ç–∂–∏–º–∞–Ω–∏—è)">
    <input type="number" id="exercise-result" placeholder="–†–µ–∑—É–ª—å—Ç–∞—Ç (–Ω–∞–ø—Ä., 20)">
    <button onclick="addExercise()">–ó–∞–ø–∏—Å–∞—Ç—å</button>
    <button onclick="toggleCollapsible('exercise-list')">–ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å</button>
    <div class="error" id="fitness-error"></div>
    <ul id="exercise-list" class="collapsible"></ul>
    <canvas id="fitness-chart"></canvas>
  </div>

  <!-- –î–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã -->
  <div class="module" id="finance-module">
    <h2>–î–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã</h2>
    <div class="finance-container">
      <div class="finance-column">
        <h3>–î–æ—Ö–æ–¥—ã</h3>
        <input type="number" id="income-amount" placeholder="–°—É–º–º–∞">
        <input type="text" id="income-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
        <button onclick="addTransaction('income')">–ó–∞–ø–∏—Å–∞—Ç—å</button>
        <ul id="income-list"></ul>
      </div>
      <div class="finance-column">
        <h3>–†–∞—Å—Ö–æ–¥—ã</h3>
        <input type="number" id="expense-amount" placeholder="–°—É–º–º–∞">
        <input type="text" id="expense-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
        <button onclick="addTransaction('expense')">–ó–∞–ø–∏—Å–∞—Ç—å</button>
        <ul id="expense-list"></ul>
      </div>
    </div>
    <div id="finance-percentage"></div>
    <canvas id="finance-chart"></canvas>
    <div class="error" id="finance-error"></div>
  </div>

  <!-- –ê—Ä—Ö–µ—Ç–∏–ø—ã -->
  <div class="module" id="archetype-module">
    <h2>–ê—Ä—Ö–µ—Ç–∏–ø—ã</h2>
    <button onclick="openArchetypeModal()">–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</button>
    <div id="archetype-result"></div>
    <div class="error" id="archetype-error"></div>
  </div>

  <!-- –ö–∞—Ä—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ -->
  <div class="module" id="strategy-module">
    <h2>–ö–∞—Ä—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</h2>
    <button onclick="openStrategyModal()">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</button>
    <div class="error" id="strategy-error"></div>
    <div id="strategy-list" class="strategy-tree"></div>
  </div>

  <!-- –¢–µ–Ω–µ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
  <div class="module" id="analytics-module">
    <h2>–¢–µ–Ω–µ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
    <button onclick="window.renderAnalytics()">–û–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É</button>
    <div id="analytics-results"></div>
    <div class="error" id="analytics-error"></div>
  </div>

  <!-- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è -->
  <div class="module" id="reminders-module">
    <h2>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</h2>
    <input type="text" id="reminder-text" placeholder="–¢–µ–∫—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è">
    <button onclick="addReminder()">–î–æ–±–∞–≤–∏—Ç—å</button>
    <div class="error" id="reminders-error"></div>
    <ul id="reminder-list"></ul>
  </div>

<!-- –õ–æ–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
  <div class="module" id="activity-module">
    <h2>–õ–æ–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h2>
    <button onclick="toggleCollapsible('activity-list')">–ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å</button>
    <div class="error" id="activity-error"></div>
    <ul id="activity-list" class="collapsible"></ul>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∞—Ä—Ö–µ—Ç–∏–ø–æ–≤ -->
  <template id="archetype-modal-template">
    <div class="modal" id="archetype-modal">
      <div class="modal-content">
        <h2>–¢–µ—Å—Ç –Ω–∞ –∞—Ä—Ö–µ—Ç–∏–ø</h2>
        <div id="questions"></div>
        <button onclick="submitArchetype()">–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å</button>
        <button onclick="closeModal('archetype-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
        <div class="error" id="archetype-modal-error"></div>
      </div>
    </div>
  </template>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ -->
  <template id="strategy-modal-template">
    <div class="modal" id="strategy-modal">
      <div class="modal-content">
        <h2>–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</h2>
        <input type="text" id="strategy-goal" placeholder="–¶–µ–ª—å">
        <select id="strategy-people">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —á–µ–ª–æ–≤–µ–∫–∞</option>
        </select>
        <input type="text" id="strategy-resources" placeholder="–†–µ—Å—É—Ä—Å—ã">
        <input type="text" id="strategy-levers" placeholder="–†—ã—á–∞–≥–∏">
        <input type="text" id="strategy-obstacles" placeholder="–ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è">
        <input type="text" id="strategy-mechanisms" placeholder="–ú–µ—Ö–∞–Ω–∏–∑–º—ã">
        <select id="strategy-status">
          <option value="plan">–ü–ª–∞–Ω</option>
          <option value="in-progress">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</option>
          <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</option>
        </select>
        <button onclick="addStrategy()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <button onclick="closeModal('strategy-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
        <div class="error" id="strategy-modal-error"></div>
      </div>
    </div>
  </template>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Eruda
    window.initEruda = () => {
      try {
        if (typeof eruda !== 'undefined') {
          eruda.init();
          eruda.show();
          console.log('Eruda –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
          logActivity('–û—Ç–∫—Ä—ã—Ç–∞ –∫–æ–Ω—Å–æ–ª—å Eruda');
        } else {
          console.error('Eruda –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
          showError('analytics', 'Eruda –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        }
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Eruda:', e);
        showError('analytics', '–û—à–∏–±–∫–∞ Eruda: ' + e.message);
      }
    };

    // –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function showError(module, message) {
      const errorDiv = document.getElementById(`${module}-error`);
      if (errorDiv) {
        errorDiv.textContent = message;
        console.log(`–û—à–∏–±–∫–∞ –≤ ${module}: ${message}`);
      }
    }

    function logActivity(message) {
      try {
        const activityList = document.getElementById('activity-list');
        if (activityList) {
          let log = JSON.parse(localStorage.getItem('activityLog') || '[]');
          const timestamp = new Date().toLocaleString();
          log.push(`${timestamp}: ${message}`);
          localStorage.setItem('activityLog', JSON.stringify(log));
          activityList.innerHTML = log.map(item => `<li>${item}</li>`).join('');
          showError('activity', '');
          console.log('–õ–æ–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:', message);
        }
      } catch (e) {
        showError('activity', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å –ª–æ–≥: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –ª–æ–≥–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:', e);
      }
    }

    function toggleCollapsible(id) {
      const element = document.getElementById(id);
      if (element) element.classList.toggle('active');
    }

    function openModal(templateId, modalId) {
      try {
        const template = document.getElementById(templateId);
        if (!template) throw new Error(`–®–∞–±–ª–æ–Ω ${templateId} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
        const modal = template.content.cloneNode(true).querySelector('.modal');
        modal.id = modalId;
        document.body.appendChild(modal);
        modal.classList.add('active');
        console.log(`–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ${modalId} –æ—Ç–∫—Ä—ã—Ç–æ`);
      } catch (e) {
        showError(modalId.split('-')[0], '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:', e);
      }
    }

    function closeModal(modalId) {
      try {
        const modal = document.getElementById(modalId);
        if (modal) modal.remove();
        console.log(`–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ${modalId} –∑–∞–∫—Ä—ã—Ç–æ`);
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:', e);
      }
    }

    // –ö–æ–¥–µ–∫—Å –Ø–¥—Ä–∞
    const coreCode = [
      { principle: "–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π —Ä–µ—Å—É—Ä—Å—ã", source: "–ú–∞–∫–∏–∞–≤–µ–ª–ª–∏", description: "–î–µ—Ä–∂–∏ –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º —Ñ–∏–Ω–∞–Ω—Å—ã, –ª—é–¥–µ–π –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é." },
      { principle: "–ü–æ–±–µ–∂–¥–∞–π –±–µ–∑ –±–æ—è", source: "–°—É–Ω—å-—Ü–∑—ã", description: "–ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä—è–º—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤." },
      { principle: "–ë—É–¥—å —Å–≤–µ—Ä—Ö—á–µ–ª–æ–≤–µ–∫–æ–º", source: "–ù–∏—Ü—à–µ", description: "–°—Ç—Ä–µ–º–∏—Å—å –∫ —Å–∞–º–æ—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–∏—é, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ –∏ —Å–∏–ª–µ." },
      { principle: "–°–∫—Ä—ã–≤–∞–π –ø–ª–∞–Ω—ã", source: "–ú–∞–∫–∏–∞–≤–µ–ª–ª–∏", description: "–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–π –Ω–∞–º–µ—Ä–µ–Ω–∏—è —Å–ª–∞–±—ã–º –∏–ª–∏ –Ω–µ–Ω–∞–¥—ë–∂–Ω—ã–º." },
      { principle: "–î–µ–π—Å—Ç–≤—É–π —Å —Ä–∞—Å—á—ë—Ç–æ–º", source: "–°—Ç–æ–∏—Ü–∏–∑–º", description: "–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π —ç–º–æ—Ü–∏–∏, –ø—Ä–∏–Ω–∏–º–∞–π —Ä–µ—à–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª–æ–≥–∏–∫–∏." },
      { principle: "–°–æ–∑–¥–∞–≤–∞–π –º–∏—Ñ", source: "–ú–∞–∫–∏–∞–≤–µ–ª–ª–∏", description: "–§–æ—Ä–º–∏—Ä—É–π –æ–±—Ä–∞–∑, –∫–æ—Ç–æ—Ä—ã–π –≤–Ω—É—à–∞–µ—Ç —É–≤–∞–∂–µ–Ω–∏–µ –∏ —Å—Ç—Ä–∞—Ö." },
      { principle: "–ò—Å–ø–æ–ª—å–∑—É–π —Å–ª–∞–±–æ—Å—Ç–∏", source: "–ö–ª–∞—É–∑–µ–≤–∏—Ü", description: "–ù–∞–π–¥–∏ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤—Ä–∞–≥–∞ –∏ –±–µ–π –ø–æ –Ω–∏–º." },
      { principle: "–§–æ–∫—É—Å –Ω–∞ –≥–ª–∞–≤–Ω–æ–º", source: "–°—É–Ω—å-—Ü–∑—ã", description: "–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É–π—Å—è –Ω–∞ –∫–ª—é—á–µ–≤—ã—Ö —Ü–µ–ª—è—Ö, –æ—Ç–±—Ä–∞—Å—ã–≤–∞—è –ª–∏—à–Ω–µ–µ." }
    ];

    const codeRecommendations = {
      'üí∞ –†–µ—Å—É—Ä—Å': '–£–∫—Ä–µ–ø–ª—è–π –∞–ª—å—è–Ω—Å, –∏—Å–ø–æ–ª—å–∑—É–π –¥–ª—è —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –≤–ª–∏—è–Ω–∏—è (–ú–∞–∫–∏–∞–≤–µ–ª–ª–∏: –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π —Ä–µ—Å—É—Ä—Å—ã).',
      'ü™® –ë–∞–ª–ª–∞—Å—Ç': '–°–≤–µ–¥–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã –∫ –º–∏–Ω–∏–º—É–º—É, –∏—Å–∫–ª—é—á–∏ –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –ø–ª–∞–Ω–æ–≤ (–°—É–Ω—å-—Ü–∑—ã: –∏–∑–±–µ–≥–∞–π —Å–ª–∞–±—ã—Ö –∞–ª—å—è–Ω—Å–æ–≤).',
      'üß† –í–Ω—É—à–∞–µ–º—ã–π': '–ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è –∏–¥–µ–π, –Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π –ª–æ—è–ª—å–Ω–æ—Å—Ç—å (–ú–∞–∫–∏–∞–≤–µ–ª–ª–∏: —É–ø—Ä–∞–≤–ª—è–π —á–µ—Ä–µ–∑ —É–±–µ–∂–¥–µ–Ω–∏–µ).',
      'üó£Ô∏è –ë–æ–ª—Ç—É–Ω': '–ò–∑–±–µ–≥–∞–π —Ä–∞–∑–≥–ª–∞—à–µ–Ω–∏—è, –¥–µ—Ä–∂–∏ –¥–∏—Å—Ç–∞–Ω—Ü–∏—é (–°—É–Ω—å-—Ü–∑—ã: —Å–∫—Ä—ã–≤–∞–π –ø–ª–∞–Ω—ã).',
      'üß© –ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä': '–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–π –∏—Ö –∞–º–±–∏—Ü–∏–∏ (–ú–∞–∫–∏–∞–≤–µ–ª–ª–∏: –ø–µ—Ä–µ—Ö–∏—Ç—Ä–∏ —Ö–∏—Ç—Ä–µ—Ü–∞).'
    };

// –ü—Ä–∞–≤–∏–ª–æ –¥–Ω—è
    function initRuleOfDay() {
      try {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ü—Ä–∞–≤–∏–ª–∞ –¥–Ω—è');
        const ruleDisplay = document.getElementById('rule-of-day');
        const lastRuleDate = localStorage.getItem('ruleDate');
        const today = new Date().toDateString();
        let currentRule = JSON.parse(localStorage.getItem('currentRule') || '{}');

        if (lastRuleDate !== today || !currentRule.principle) {
          currentRule = coreCode[Math.floor(Math.random() * coreCode.length)];
          localStorage.setItem('currentRule', JSON.stringify(currentRule));
          localStorage.setItem('ruleDate', today);
        }

        ruleDisplay.innerHTML = `${currentRule.principle} (${currentRule.source})<br>${currentRule.description}`;
        logActivity(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª–æ –¥–Ω—è: ${currentRule.principle}`);
        showError('rule', '');
        console.log('–ü—Ä–∞–≤–∏–ª–æ –¥–Ω—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
      } catch (e) {
        showError('rule', '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ü—Ä–∞–≤–∏–ª–∞ –¥–Ω—è:', e);
      }
    }

    window.updateRuleOfDay = () => {
      try {
        const ruleDisplay = document.getElementById('rule-of-day');
        const currentRule = coreCode[Math.floor(Math.random() * coreCode.length)];
        localStorage.setItem('currentRule', JSON.stringify(currentRule));
        localStorage.setItem('ruleDate', new Date().toDateString());
        ruleDisplay.innerHTML = `${currentRule.principle} (${currentRule.source})<br>${currentRule.description}`;
        logActivity(`–û–±–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª–æ –¥–Ω—è: ${currentRule.principle}`);
        showError('rule', '');
      } catch (e) {
        showError('rule', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª–∞ –¥–Ω—è:', e);
      }
    };

    // –°–ø—Ä–∞–≤–∫–∞
    function initReference() {
      try {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –°–ø—Ä–∞–≤–∫–∏');
        const searchInput = document.getElementById('reference-search');
        const contentDiv = document.getElementById('reference-content');
        const renderReference = () => {
          const search = searchInput.value.toLowerCase();
          const filtered = coreCode.filter(c => c.principle.toLowerCase().includes(search) || c.description.toLowerCase().includes(search));
          contentDiv.innerHTML = filtered.map(c => `<p><strong>${c.principle} (${c.source})</strong>: ${c.description}</p>`).join('');
        };
        renderReference();
        searchInput.addEventListener('input', renderReference);
        logActivity('–°–ø—Ä–∞–≤–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
        showError('reference', '');
        console.log('–°–ø—Ä–∞–≤–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
      } catch (e) {
        showError('reference', '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –°–ø—Ä–∞–≤–∫–∏:', e);
      }
    }

    // –ü–ª–∞–Ω –¥–Ω—è
    function initPlan() {
      try {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ü–ª–∞–Ω–∞ –¥–Ω—è');
        const planText = document.getElementById('plan-text');
        const planPriority = document.getElementById('plan-priority');
        const planList = document.getElementById('plan-list');
        let plans = JSON.parse(localStorage.getItem('plans') || '[]');

        const renderPlans = () => {
          try {
            planList.innerHTML = '';
            plans.forEach((plan, index) => {
              const li = document.createElement('li');
              li.innerHTML = `
                ${plan.text} (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: ${plan.priority}, ${new Date(plan.created).toLocaleDateString()})
                <button onclick="deletePlan(${index})">‚ùå</button>
              `;
              planList.appendChild(li);
            });
            window.renderAnalytics();
            showError('plan', '');
            console.log('–ü–ª–∞–Ω –¥–Ω—è –æ—Ç–æ–±—Ä–∞–∂—ë–Ω:', plans);
          } catch (e) {
            showError('plan', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ø–ª–∞–Ω: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –ø–ª–∞–Ω–∞:', e);
          }
        };

        window.addPlan = () => {
          try {
            const text = planText.value.trim();
            const priority = planPriority.value;
            if (text) {
              plans.push({ text, priority, created: new Date().toISOString() });
              localStorage.setItem('plans', JSON.stringify(plans));
              planText.value = '';
              planPriority.value = 'low';
              renderPlans();
              logActivity(`–î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–∞—á–∞ –≤ –ø–ª–∞–Ω: ${text}`);
              showError('plan', '');
            } else {
              showError('plan', '–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞—á—É');
            }
          } catch (e) {
            showError('plan', '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:', e);
          }
        };

        window.deletePlan = (index) => {
          try {
            const text = plans[index].text;
            plans.splice(index, 1);
            localStorage.setItem('plans', JSON.stringify(plans));
            renderPlans();
            logActivity(`–£–¥–∞–ª–µ–Ω–∞ –∑–∞–¥–∞—á–∞: ${text}`);
            showError('plan', '');
          } catch (e) {
            showError('plan', '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏:', e);
          }
        };

        renderPlans();
        console.log('–ü–ª–∞–Ω –¥–Ω—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
      } catch (e) {
        showError('plan', '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ü–ª–∞–Ω–∞:', e);
      }
    }

    // –û–∫—Ä—É–∂–µ–Ω–∏–µ
    function initEnvironment() {
      try {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –û–∫—Ä—É–∂–µ–Ω–∏—è');
        const personName = document.getElementById('person-name');
        const personStatus = document.getElementById('person-status');
        const personTags = document.getElementById('person-tags');
        const personKarma = document.getElementById('person-karma');
        const personConnections = document.getElementById('person-connections');
        const personList = document.getElementById('person-list');
        let people = JSON.parse(localStorage.getItem('people') || '[]');

        const renderPeople = () => {
          try {
            personList.innerHTML = '';
            people.forEach((person, index) => {
              const tagsDisplay = person.tags.length > 0 ? person.tags.join(', ') : '–Ω–µ—Ç';
              const connectionsDisplay = person.connections.length > 0 ? person.connections.join(', ') : '–Ω–µ—Ç';
              const recommendations = person.tags.map(tag => codeRecommendations[tag] || '').join('<br>');
              const li = document.createElement('li');
              li.className = 'profile-card';
              li.innerHTML = `
                <div>
                  <strong>${person.name}</strong> (${person.status}, –ö–∞—Ä–º–∞: ${person.karma})<br>
                  –ú–µ—Ç–∫–∏: ${tagsDisplay}<br>
                  –°–≤—è–∑–∏: ${connectionsDisplay}<br>
                  –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: ${recommendations || '–ù–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π'}<br>
                  <button onclick="adjustKarma(${index}, 5)">+5</button>
                  <button onclick="adjustKarma(${index}, -10)">-10</button>
                  <button onclick="deletePerson(${index})">‚ùå</button>
                </div>
              `;
              personList.appendChild(li);
            });
            updateConnectionsSelect();
            renderNetwork();
            if (window.updateStrategyPeopleSelect) window.updateStrategyPeopleSelect();
            window.renderAnalytics();
            showError('environment', '');
            console.log('–õ—é–¥–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã:', people);
          } catch (e) {
            showError('environment', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –ª—é–¥–µ–π:', e);
          }
        };

        const updateConnectionsSelect = () => {
          try {
            personConnections.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤—è–∑–∏</option>';
            people.forEach(person => {
              const option = document.createElement('option');
              option.value = person.name;
              option.textContent = person.name;
              personConnections.appendChild(option);
            });
            console.log('–°–≤—è–∑–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
          } catch (e) {
            showError('environment', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å–≤—è–∑–∏: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≤—è–∑–µ–π:', e);
          }
        };

        const renderNetwork = () => {
          try {
            const container = document.getElementById('network');
            if (!container) return;
            const nodes = people.map((person, index) => ({
              id: index,
              label: person.name,
              color: person.status === 'loyal' ? '#00ff00' : person.status === 'neutral' ? '#ffff00' : '#ff4444'
            }));
            const edges = [];
            people.forEach((person, index) => {
              person.connections.forEach(connection => {
                const targetIndex = people.findIndex(p => p.name === connection);
                if (targetIndex !== -1) {
                  edges.push({ from: index, to: targetIndex });
                }
              });
            });
            const data = { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
            const options = { nodes: { shape: 'dot', size: 20 }, edges: { arrows: 'to' } };
            new vis.Network(container, data, options);
            console.log('–ì—Ä–∞—Ñ —Å–≤—è–∑–µ–π –æ—Ç–æ–±—Ä–∞–∂—ë–Ω');
          } catch (e) {
            showError('environment', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≥—Ä–∞—Ñ: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –≥—Ä–∞—Ñ–∞:', e);
          }
        };

        window.addPerson = () => {
          try {
            const name = personName.value.trim();
            const status = personStatus.value;
            const tags = Array.from(personTags.selectedOptions).map(opt => opt.value);
            const karma = parseInt(personKarma.value) || 0;
            const connections = Array.from(personConnections.selectedOptions).map(opt => opt.value);
            if (name) {
              people.push({ name, status, tags, karma, connections });
              localStorage.setItem('people', JSON.stringify(people));
              personName.value = '';
              personStatus.value = 'loyal';
              Array.from(personTags.options).forEach(option => option.selected = false);
              personKarma.value = '0';
              Array.from(personConnections.options).forEach(option => option.selected = false);
              renderPeople();
              logActivity(`–î–æ–±–∞–≤–ª–µ–Ω —á–µ–ª–æ–≤–µ–∫: ${name}`);
              showError('environment', '');
            } else {
              showError('environment', '–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
            }
          } catch (e) {
            showError('environment', '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–∞:', e);
          }
        };


window.adjustKarma = (index, change) => {
          try {
            people[index].karma = Math.max(-100, Math.min(100, people[index].karma + change));
            localStorage.setItem('people', JSON.stringify(people));
            renderPeople();
            logActivity(`–ò–∑–º–µ–Ω–µ–Ω–∞ –∫–∞—Ä–º–∞ –¥–ª—è ${people[index].name}: ${people[index].karma}`);
            showError('environment', '');
          } catch (e) {
            showError('environment', '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ä–º—É: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Ä–º—ã:', e);
          }
        };

        window.deletePerson = (index) => {
          try {
            const name = people[index].name;
            people.splice(index, 1);
            localStorage.setItem('people', JSON.stringify(people));
            renderPeople();
            logActivity(`–£–¥–∞–ª—ë–Ω —á–µ–ª–æ–≤–µ–∫: ${name}`);
            showError('environment', '');
          } catch (e) {
            showError('environment', '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–∞:', e);
          }
        };

        renderPeople();
        updateConnectionsSelect();
        console.log('–û–∫—Ä—É–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
      } catch (e) {
        showError('environment', '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –û–∫—Ä—É–∂–µ–Ω–∏—è:', e);
      }
    }

    // –§–∏–∑–æ
    function initFitness() {
      try {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –§–∏–∑–æ');
        const exerciseType = document.getElementById('exercise-type');
        const exerciseResult = document.getElementById('exercise-result');
        const exerciseList = document.getElementById('exercise-list');
        const fitnessChart = document.getElementById('fitness-chart').getContext('2d');
        let exercises = JSON.parse(localStorage.getItem('exercises') || '[]');
        let chart;

        const renderExercises = () => {
          try {
            exerciseList.innerHTML = '';
            const types = [...new Set(exercises.map(e => e.type))];
            types.forEach(type => {
              const li = document.createElement('li');
              li.innerHTML = `${type}: ${exercises.filter(e => e.type === type).map(e => `${e.result} (${new Date(e.date).toLocaleDateString()})`).join(', ')}
                <button onclick="deleteExerciseType('${type}')">‚ùå</button>`;
              exerciseList.appendChild(li);
            });
            updateFitnessChart();
            window.renderAnalytics();
            showError('fitness', '');
            console.log('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã:', exercises);
          } catch (e) {
            showError('fitness', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π:', e);
          }
        };

        const updateFitnessChart = () => {
          try {
            const now = new Date();
            const sevenDaysAgo = new Date(now - 7 * 24 * 60 * 60 * 1000);
            const recentExercises = exercises.filter(e => new Date(e.date) >= sevenDaysAgo);
            const types = [...new Set(recentExercises.map(e => e.type))];
            const dates = [];
            for (let i = 6; i >= 0; i--) {
              const date = new Date(now - i * 24 * 60 * 60 * 1000);
              dates.push(date.toLocaleDateString());
            }
            const datasets = types.map(type => ({
              label: type,
              data: dates.map(date => {
                const exercise = recentExercises.find(e => e.type === type && new Date(e.date).toLocaleDateString() === date);
                return exercise ? exercise.result : 0;
              }),
              borderColor: '#' + Math.floor(Math.random()*16777215).toString(16),
              fill: false
            }));

            if (chart) chart.destroy();
            chart = new Chart(fitnessChart, {
              type: 'line',
              data: { labels: dates, datasets },
              options: { scales: { y: { beginAtZero: true } } }
            });
            showError('fitness', '');
            console.log('–ì—Ä–∞—Ñ–∏–∫ —Ñ–∏–∑–æ –æ–±–Ω–æ–≤–ª—ë–Ω');
          } catch (e) {
            showError('fitness', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ —Ñ–∏–∑–æ:', e);
          }
        };

        window.addExercise = () => {
          try {
            const type = exerciseType.value.trim();
            const result = parseInt(exerciseResult.value);
            if (type && !isNaN(result) && result > 0) {
              exercises.push({ type, result, date: new Date().toISOString() });
              localStorage.setItem('exercises', JSON.stringify(exercises));
              exerciseType.value = '';
              exerciseResult.value = '';
              renderExercises();
              logActivity(`–î–æ–±–∞–≤–ª–µ–Ω–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: ${type}, ${result}`);
              showError('fitness', '');
            } else {
              showError('fitness', '–í–≤–µ–¥–∏—Ç–µ —Ç–∏–ø –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç (>0)');
            }
          } catch (e) {
            showError('fitness', '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è:', e);
          }
        };

        window.deleteExerciseType = (type) => {
          try {
            exercises = exercises.filter(e => e.type !== type);
            localStorage.setItem('exercises', JSON.stringify(exercises));
            renderExercises();
            logActivity(`–£–¥–∞–ª–µ–Ω—ã —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è —Ç–∏–ø–∞: ${type}`);
            showError('fitness', '');
          } catch (e) {
            showError('fitness', '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π:', e);
          }
        };

        renderExercises();
        console.log('–§–∏–∑–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
      } catch (e) {
        showError('fitness', '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –§–∏–∑–æ:', e);
      }
    }

    // –î–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã
    function initFinance() {
      try {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –§–∏–Ω–∞–Ω—Å–æ–≤');
        const incomeAmount = document.getElementById('income-amount');
        const incomeDescription = document.getElementById('income-description');
        const expenseAmount = document.getElementById('expense-amount');
        const expenseDescription = document.getElementById('expense-description');
        const incomeList = document.getElementById('income-list');
        const expenseList = document.getElementById('expense-list');
        const percentageText = document.getElementById('finance-percentage');
        const financeChart = document.getElementById('finance-chart').getContext('2d');
        let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
        let chart;

        const renderTransactions = () => {
          try {
            incomeList.innerHTML = '';
            expenseList.innerHTML = '';
            const last30Days = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
            const recentTransactions = transactions.filter(t => new Date(t.date) >= last30Days);

            recentTransactions.forEach((transaction, index) => {
              const li = document.createElement('li');
              li.innerHTML = `${transaction.amount} - ${transaction.description} (${new Date(transaction.date).toLocaleDateString()})
                <button onclick="deleteTransaction(${index})">‚ùå</button>`;
              if (transaction.type === 'income') {
                incomeList.appendChild(li);
              } else {
                expenseList.appendChild(li);
              }
            });

            const income = recentTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expense = recentTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const total = income + expense;
            const percentage = total ? (income / total * 100).toFixed(2) : 0;
            percentageText.textContent = `–î–æ—Ö–æ–¥—ã: ${income} | –†–∞—Å—Ö–æ–¥—ã: ${expense} | –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${percentage}%`;
            percentageText.style.color = percentage > 50 ? '#00ff00' : percentage == 50 ? '#ffff00' : '#ff4444';

            updateFinanceChart();
            window.renderAnalytics();
            showError('finance', '');
            console.log('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã:', transactions);
          } catch (e) {
            showError('finance', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:', e);
          }
        };

        const updateFinanceChart = () => {
          try {
            const dates = [...new Set(transactions.map(t => new Date(t.date).toLocaleDateString()))];
            const incomeData = dates.map(date => {
              return transactions
                .filter(t => t.type === 'income' && new Date(t.date).toLocaleDateString() === date)
                .reduce((sum, t) => sum + t.amount, 0);
            });
            const expenseData = dates.map(date => {
              return transactions
                .filter(t => t.type === 'expense' && new Date(t.date).toLocaleDateString() === date)
                .reduce((sum, t) => sum + t.amount, 0);
            });

            if (chart) chart.destroy();
            chart = new Chart(financeChart, {
              type: 'line',
              data: {
                labels: dates,
                datasets: [
                  { label: '–î–æ—Ö–æ–¥—ã', data: incomeData, borderColor: '#00ff00', fill: false },
                  { label: '–†–∞—Å—Ö–æ–¥—ã', data: expenseData, borderColor: '#ff4444', fill: false }
                ]
              },
              options: { scales: { y: { beginAtZero: true } } }
            });
            console.log('–ì—Ä–∞—Ñ–∏–∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤ –æ–±–Ω–æ–≤–ª—ë–Ω');
          } catch (e) {
            showError('finance', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤:', e);
          }
        };

        window.addTransaction = (type) => {
          try {
            const amount = parseFloat(type === 'income' ? incomeAmount.value : expenseAmount.value);
            const description = (type === 'income' ? incomeDescription.value : expenseDescription.value).trim();
            if (!isNaN(amount) && amount > 0 && description) {
              transactions.push({ amount, type, description, date: new Date().toISOString() });
              localStorage.setItem('transactions', JSON.stringify(transactions));
              if (type === 'income') {
                incomeAmount.value = '';
                incomeDescription.value = '';
              } else {
                expenseAmount.value = '';
                expenseDescription.value = '';
              }
              renderTransactions();
              logActivity(`–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: ${type}, ${amount}`);
              showError('finance', '');
            } else {
              showError('finance', '–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É (>0) –∏ –æ–ø–∏—Å–∞–Ω–∏–µ');
            }
          } catch (e) {
            showError('finance', '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:', e);
          }
        };

        window.deleteTransaction = (index) => {
          try {
            const transaction = transactions[index];
            transactions.splice(index, 1);
            localStorage.setItem('transactions', JSON.stringify(transactions));
            renderTransactions();
            logActivity(`–£–¥–∞–ª–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: ${transaction.type}, ${transaction.amount}`);
            showError('finance', '');
          } catch (e) {
            showError('finance', '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:', e);
          }
        };

        renderTransactions();
        console.log('–§–∏–Ω–∞–Ω—Å—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
      } catch (e) {
        showError('finance', '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –§–∏–Ω–∞–Ω—Å–æ–≤:', e);
      }
    }

    // –ê—Ä—Ö–µ—Ç–∏–ø—ã
    function initArchetype() {
      try {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ê—Ä—Ö–µ—Ç–∏–ø–æ–≤');
        const archetypeResult = document.getElementById('archetype-result');
        let archetype = localStorage.getItem('archetype') || '';
        if (archetype) {
          archetypeResult.innerHTML = `–í–∞—à –∞—Ä—Ö–µ—Ç–∏–ø: ${archetype}<br>${getArchetypeRecommendations(archetype)}`;
        }
        console.log('–ê—Ä—Ö–µ—Ç–∏–ø—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
      } catch (e) {
        showError('archetype', '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ê—Ä—Ö–µ—Ç–∏–ø–æ–≤:', e);
      }
    }


function openArchetypeModal() {
      try {
        openModal('archetype-modal-template', 'archetype-modal');
        const questionsDiv = document.getElementById('questions');
        const questions = [
          { text: '–ö–∞–∫ –≤—ã –ø—Ä–∏–Ω–∏–º–∞–µ—Ç–µ —Ä–µ—à–µ–Ω–∏—è?', options: ['–õ–æ–≥–∏–∫–∞', '–≠–º–æ—Ü–∏–∏', '–ò–Ω—Ç—É–∏—Ü–∏—è', '–ê–Ω–∞–ª–∏–∑'] },
          { text: '–ö–∞–∫ –≤—ã –æ–±—â–∞–µ—Ç–µ—Å—å —Å –ª—é–¥—å–º–∏?', options: ['–ü—Ä—è–º–æ', '–û—Å—Ç–æ—Ä–æ–∂–Ω–æ', '–ú–∞–Ω–∏–ø—É–ª—è—Ç–∏–≤–Ω–æ', '–û—Ç–∫—Ä—ã—Ç–æ'] },
          { text: '–í–∞—à–∞ —Ü–µ–ª—å –≤ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ?', options: ['–ü–æ–±–µ–¥–∞', '–ö–æ–º–ø—Ä–æ–º–∏—Å—Å', '–ò–∑–±–µ–∂–∞–Ω–∏–µ', '–ö–æ–Ω—Ç—Ä–æ–ª—å'] }
        ];
        questionsDiv.innerHTML = questions.map((q, i) => `
          <div>
            <p>${q.text}</p>
            ${q.options.map(opt => `<button onclick="selectAnswer(${i}, '${opt}')">${opt}</button>`).join('')}
          </div>
        `).join('');
        showError('archetype-modal', '');
        console.log('–¢–µ—Å—Ç –∞—Ä—Ö–µ—Ç–∏–ø–æ–≤ –æ—Ç–∫—Ä—ã—Ç');
      } catch (e) {
        showError('archetype-modal', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞:', e);
      }
    }

    window.selectAnswer = (questionIndex, answer) => {
      try {
        let answers = JSON.parse(localStorage.getItem('archetypeAnswers') || '{}');
        answers[questionIndex] = answer;
        localStorage.setItem('archetypeAnswers', JSON.stringify(answers));
        console.log('–û—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω:', { questionIndex, answer });
      } catch (e) {
        showError('archetype-modal', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞:', e);
      }
    };

    window.submitArchetype = () => {
      try {
        const answers = JSON.parse(localStorage.getItem('archetypeAnswers') || '{}');
        if (Object.keys(answers).length < 3) {
          showError('archetype-modal', '–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã');
          return;
        }
        const archetype = determineArchetype(answers);
        localStorage.setItem('archetype', archetype);
        document.getElementById('archetype-result').innerHTML = `–í–∞—à –∞—Ä—Ö–µ—Ç–∏–ø: ${archetype}<br>${getArchetypeRecommendations(archetype)}`;
        closeModal('archetype-modal');
        logActivity(`–û–ø—Ä–µ–¥–µ–ª—ë–Ω –∞—Ä—Ö–µ—Ç–∏–ø: ${archetype}`);
        showError('archetype', '');
      } catch (e) {
        showError('archetype-modal', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞—Ä—Ö–µ—Ç–∏–ø: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞—Ä—Ö–µ—Ç–∏–ø–∞:', e);
      }
    };

    function determineArchetype(answers) {
      const scores = { Strategist: 0, Manipulator: 0, Leader: 0 };
      if (answers[0] === '–õ–æ–≥–∏–∫–∞' || answers[0] === '–ê–Ω–∞–ª–∏–∑') scores.Strategist += 1;
      if (answers[1] === '–ú–∞–Ω–∏–ø—É–ª—è—Ç–∏–≤–Ω–æ') scores.Manipulator += 1;
      if (answers[2] === '–ü–æ–±–µ–¥–∞' || answers[2] === '–ö–æ–Ω—Ç—Ä–æ–ª—å') scores.Leader += 1;
      return Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);
    }

    function getArchetypeRecommendations(archetype) {
      const recommendations = {
        Strategist: '–°–æ–∑–¥–∞–≤–∞–π –º–∏—Ñ –æ —Å–µ–±–µ, –ø–ª–∞–Ω–∏—Ä—É–π –Ω–∞ —Ç—Ä–∏ —à–∞–≥–∞ –≤–ø–µ—Ä—ë–¥ (–ú–∞–∫–∏–∞–≤–µ–ª–ª–∏).',
        Manipulator: '–£–ø—Ä–∞–≤–ª—è–π —ç–º–æ—Ü–∏—è–º–∏ –¥—Ä—É–≥–∏—Ö, —Å–æ–∑–¥–∞–≤–∞–π –∏–ª–ª—é–∑–∏—é –≤—ã–±–æ—Ä–∞ (–ù–∏—Ü—à–µ).',
        Leader: '–ë—É–¥—å –æ—Å—å—é, –≤–æ–∫—Ä—É–≥ –∫–æ—Ç–æ—Ä–æ–π –≤—Ä–∞—â–∞—é—Ç—Å—è, –∑–∞–¥–∞–≤–∞–π –ø—Ä–∞–≤–∏–ª–∞ (–°—É–Ω—å-—Ü–∑—ã).'
      };
      return recommendations[archetype] || '–î–µ–π—Å—Ç–≤—É–π —Å —Ö–æ–ª–æ–¥–Ω—ã–º —Ä–∞—Å—á—ë—Ç–æ–º.';
    }

    // –ö–∞—Ä—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    function initStrategy() {
      try {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ö–∞—Ä—Ç—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏');
        const strategyList = document.getElementById('strategy-list');
        let strategies = JSON.parse(localStorage.getItem('strategies') || '[]');

        window.updateStrategyPeopleSelect = () => {
          try {
            const peopleSelect = document.getElementById('strategy-people');
            if (!peopleSelect) return;
            const people = JSON.parse(localStorage.getItem('people') || '[]');
            peopleSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —á–µ–ª–æ–≤–µ–∫–∞</option>';
            people.forEach(person => {
              const option = document.createElement('option');
              option.value = person.name;
              option.textContent = person.name;
              peopleSelect.appendChild(option);
            });
            console.log('–°–ø–∏—Å–æ–∫ –ª—é–¥–µ–π –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –æ–±–Ω–æ–≤–ª—ë–Ω');
          } catch (e) {
            showError('strategy', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ª—é–¥–µ–π: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ª—é–¥–µ–π:', e);
          }
        };

        const renderStrategies = () => {
          try {
            strategyList.innerHTML = '';
            strategies.forEach((strategy, index) => {
              const div = document.createElement('div');
              div.className = 'strategy-node';
              const scenario = simulateScenario(strategy);
              div.innerHTML = `
                <strong>–¶–µ–ª—å: ${strategy.goal}</strong> (–°—Ç–∞—Ç—É—Å: ${strategy.status}, –õ—é–¥–∏: ${strategy.people || '–Ω–µ—Ç'})<br>
                –†–µ—Å—É—Ä—Å—ã: ${strategy.resources || '–Ω–µ—Ç'}<br>
                <div class="strategy-branch">
                  <div class="strategy-node">–†—ã—á–∞–≥–∏: ${strategy.levers || '–Ω–µ—Ç'}</div>
                  <div class="strategy-node">–ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è: ${strategy.obstacles || '–Ω–µ—Ç'}</div>
                  <div class="strategy-node">–ú–µ—Ö–∞–Ω–∏–∑–º—ã: ${strategy.mechanisms || '–Ω–µ—Ç'}</div>
                </div>
                –ü—Ä–æ–≥–Ω–æ–∑: ${scenario}<br>
                <button onclick="deleteStrategy(${index})">‚ùå</button>
              `;
              strategyList.appendChild(div);
            });
            window.renderAnalytics();
            showError('strategy', '');
            console.log('–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã:', strategies);
          } catch (e) {
            showError('strategy', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π:', e);
          }
        };

        function simulateScenario(strategy) {
          try {
            const people = JSON.parse(localStorage.getItem('people') || '[]');
            const person = people.find(p => p.name === strategy.people);
            let score = 0;
            if (person) {
              score += person.status === 'loyal' ? 20 : person.status === 'neutral' ? 10 : -10;
              score += person.karma / 2;
              if (person.tags.includes('üí∞ –†–µ—Å—É—Ä—Å')) score += 15;
              if (person.tags.includes('ü™® –ë–∞–ª–ª–∞—Å—Ç')) score -= 15;
            }
            if (strategy.resources) score += 10;
            if (strategy.levers) score += 10;
            if (strategy.obstacles) score -= 5;
            if (strategy.mechanisms) score += 10;
            return score > 30 ? '–í—ã—Å–æ–∫–∏–π —à–∞–Ω—Å —É—Å–ø–µ—Ö–∞' : score > 0 ? '–£–º–µ—Ä–µ–Ω–Ω—ã–π —à–∞–Ω—Å' : '–ù–∏–∑–∫–∏–π —à–∞–Ω—Å, –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ';
          } catch (e) {
            console.error('–û—à–∏–±–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è:', e);
            return '–û—à–∏–±–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–∞';
          }
        }

        window.addStrategy = () => {
          try {
            const goal = document.getElementById('strategy-goal').value.trim();
            const people = document.getElementById('strategy-people').value;
            const resources = document.getElementById('strategy-resources').value.trim();
            const levers = document.getElementById('strategy-levers').value.trim();
            const obstacles = document.getElementById('strategy-obstacles').value.trim();
            const mechanisms = document.getElementById('strategy-mechanisms').value.trim();
            const status = document.getElementById('strategy-status').value;
            if (goal) {
              strategies.push({ goal, people, resources, levers, obstacles, mechanisms, status });
              localStorage.setItem('strategies', JSON.stringify(strategies));
              document.getElementById('strategy-goal').value = '';
              document.getElementById('strategy-people').value = '';
              document.getElementById('strategy-resources').value = '';
              document.getElementById('strategy-levers').value = '';
              document.getElementById('strategy-obstacles').value = '';
              document.getElementById('strategy-mechanisms').value = '';
              document.getElementById('strategy-status').value = 'plan';
              renderStrategies();
              logActivity(`–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è: ${goal}`);
              closeModal('strategy-modal');
              showError('strategy', '');
            } else {
              showError('strategy-modal', '–í–≤–µ–¥–∏—Ç–µ —Ü–µ–ª—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏');
            }
          } catch (e) {
            showError('strategy-modal', '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:', e);
          }
        };

        window.deleteStrategy = (index) => {
          try {
            const goal = strategies[index].goal;
            strategies.splice(index, 1);
            localStorage.setItem('strategies', JSON.stringify(strategies));
            renderStrategies();
            logActivity(`–£–¥–∞–ª–µ–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è: ${goal}`);
            showError('strategy', '');
          } catch (e) {
            showError('strategy', '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:', e);
          }
        };

        window.updateStrategyPeopleSelect();
        renderStrategies();
        console.log('–ö–∞—Ä—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
      } catch (e) {
        showError('strategy', '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –°—Ç—Ä–∞—Ç–µ–≥–∏–π:', e);
      }
    }

    function openStrategyModal() {
      try {
        openModal('strategy-modal-template', 'strategy-modal');
        window.updateStrategyPeopleSelect();
        showError('strategy-modal', '');
        console.log('–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ—Ç–∫—Ä—ã—Ç–æ');
      } catch (e) {
        showError('strategy-modal', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:', e);
      }
    }

    // –¢–µ–Ω–µ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
    window.renderAnalytics = () => {
      try {
        console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏');
        const analyticsResults = document.getElementById('analytics-results');
        if (!analyticsResults) return;
        const people = JSON.parse(localStorage.getItem('people') || '[]');
        const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
        const plans = JSON.parse(localStorage.getItem('plans') || '[]');
        const strategies = JSON.parse(localStorage.getItem('strategies') || '[]');
        const exercises = JSON.parse(localStorage.getItem('exercises') || '[]');
        let results = '<h3>–¢–µ–Ω–µ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3><ul>';

        // –û–∫—Ä—É–∂–µ–Ω–∏–µ
        const negativeKarma = people.filter(p => p.karma < 0);
        results += negativeKarma.length > 0
          ? `<li>–õ—é–¥–∏ —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π –∫–∞—Ä–º–æ–π: ${negativeKarma.map(p => `${p.name} (${p.karma})`).join(', ')}. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ò—Å–∫–ª—é—á–∏—Ç–µ —Å–ª–∞–±—ã–µ –∞–ª—å—è–Ω—Å—ã (–°—É–Ω—å-—Ü–∑—ã).</li>`
          : '<li>–ù–µ—Ç –ª—é–¥–µ–π —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π –∫–∞—Ä–º–æ–π.</li>';

        people.forEach(person => {
          person.tags.forEach(tag => {
            if (codeRecommendations[tag]) {
              results += `<li>${person.name} (${tag}): ${codeRecommendations[tag]}</li>`;
            }
          });
        });

        // –§–∏–Ω–∞–Ω—Å—ã
        const last30Days = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
        const recentTransactions = transactions.filter(t => new Date(t.date) >= last30Days);
        const income = recentTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
        const expense = recentTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
        const total = income + expense;
        const percentage = total ? (income / total * 100).toFixed(2) : 0;
        results += `<li>–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${percentage}%. ${
          percentage > 50 ? '–•–æ—Ä–æ—à–æ, –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã (–ú–∞–∫–∏–∞–≤–µ–ª–ª–∏).' : '–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è, —Å–æ–∫—Ä–∞—Ç–∏—Ç–µ –Ω–µ–Ω—É–∂–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã (–°—É–Ω—å-—Ü–∑—ã).'
        }</li>`;

        // –ü–ª–∞–Ω –¥–Ω—è
        const highPriority = plans.filter(p => p.priority === 'high');
        results += highPriority.length > 0
          ? `<li>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏: ${highPriority.map(p => p.text).join(', ')}. –°—Ñ–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –∫–ª—é—á–µ–≤—ã—Ö —Ü–µ–ª—è—Ö (–ù–∏—Ü—à–µ).</li>`
          : '<li>–ù–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã—Ö –∑–∞–¥–∞—á. –î–æ–±–∞–≤—å—Ç–µ —Ü–µ–ª–∏ –¥–ª—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã.</li>';

        // –§–∏–∑–æ
        const recentExercises = exercises.filter(e => new Date(e.date) >= last30Days);
        const types = [...new Set(recentExercises.map(e => e.type))];
        results += types.length > 0
          ? `<li>–§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${types.join(', ')}. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É (–ù–∏—Ü—à–µ: —Ç–µ–ª–æ ‚Äî –æ—Å–Ω–æ–≤–∞ —Å–∏–ª—ã).</li>`
          : '<li>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –ù–∞—á–Ω–∏—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏.</li>';

        // –°—Ç—Ä–∞—Ç–µ–≥–∏–∏
        const activeStrategies = strategies.filter(s => s.status === 'in-progress');
        results += activeStrategies.length > 0
          ? `<li>–ê–∫—Ç–∏–≤–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: ${activeStrategies.map(s => s.goal).join(', ')}. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ä—ã—á–∞–≥–∏ –≤–ª–∏—è–Ω–∏—è (–ú–∞–∫–∏–∞–≤–µ–ª–ª–∏).</li>`
          : '<li>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π. –ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –Ω–∞ —Ç—Ä–∏ —à–∞–≥–∞ –≤–ø–µ—Ä—ë–¥ (–°—É–Ω—å-—Ü–∑—ã).</li>';

        results += '</ul>';
        analyticsResults.innerHTML = results;
        logActivity('–û–±–Ω–æ–≤–ª–µ–Ω–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞');
        showError('analytics', '');
        console.log('–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
      } catch (e) {
        showError('analytics', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:', e);
      }
    };

    // –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
    function initReminders() {
      try {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π');
        const reminderText = document.getElementById('reminder-text');
        const reminderList = document.getElementById('reminder-list');
        let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');

        const renderReminders = () => {
          try {
            reminderList.innerHTML = '';
            tasks.forEach((task, index) => {
              const li = document.createElement('li');
              li.innerHTML = `
                ${task.text} (${new Date(task.created).toLocaleDateString()})
                <button onclick="deleteReminder(${index})">‚ùå</button>
              `;
              reminderList.appendChild(li);
            });
            window.renderAnalytics();
            showError('reminders', '');
            console.log('–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã:', tasks);
          } catch (e) {
            showError('reminders', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π:', e);
          }
        };

        window.addReminder = () => {
          try {
            const text = reminderText.value.trim();
            if (text) {
              tasks.push({ text, created: new Date().toISOString(), completed: false });
              localStorage.setItem('tasks', JSON.stringify(tasks));
              reminderText.value = '';
              renderReminders();
              logActivity(`–î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: ${text}`);
              showError('reminders', '');
            } else {
              showError('reminders', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è');
            }
          } catch (e) {
            showError('reminders', '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:', e);
          }
        };

        window.deleteReminder = (index) => {
          try {
            const text = tasks[index].text;
            tasks.splice(index, 1);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderReminders();
            logActivity(`–£–¥–∞–ª–µ–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: ${text}`);
            showError('reminders', '');
          } catch (e) {
            showError('reminders', '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è:', e);
          }
        };

        renderReminders();
        console.log('–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
      } catch (e) {
        showError('reminders', '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π:', e);
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', () => {
      console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é');
      initRuleOfDay();
      initReference();
      initPlan();
      initEnvironment();
      initFitness();
      initFinance();
      initArchetype();
      initStrategy();
      initReminders();
      console.log('–í—Å–µ –º–æ–¥—É–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');

      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js')
          .then(() => {
            console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
            logActivity('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
          })
          .catch(err => {
            console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', err);
            showError('analytics', '–û—à–∏–±–∫–∞ Service Worker: ' + err.message);
          });
      }
    });
  </script>
</body>
</html>