<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BlackTrigger HQ</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1a1a1a">
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #1a1a1a; color: #e0e0e0; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; background-size: cover; }
    .nav-bar { display: flex; flex-wrap: wrap; justify-content: space-around; background: #222; padding: 10px; margin-bottom: 20px; border-radius: 5px; }
    .module { border: 1px solid #444; margin: 10px 0; border-radius: 5px; }
    .module-header { padding: 10px; background: #333; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
    .module-content { padding: 10px; display: none; }
    .module.always-open .module-content { display: block; }
    .module:not(.collapsed) .module-content { display: block; }
    .error { color: #ff5555; margin: 10px 0; }
    .rule-actions { display: flex; justify-content: space-between; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
    .modal-content { background: #333; padding: 20px; margin: 10% auto; width: 80%; max-width: 600px; border-radius: 5px; }
    .modal.show { display: block; }
    .critical-notification { display: none; color: #ff5555; padding: 10px; border: 1px solid #ff5555; margin: 10px 0; }
    .button-small { padding: 10px 18px; font-size: 14px; }
    .button-medium { padding: 16px 24px; font-size: 18px; } /* –£–≤–µ–ª–∏—á–∏–ª –∫–Ω–æ–ø–∫–∏ */
    .button-large { padding: 20px 28px; font-size: 20px; }
    .module-small { max-width: 300px; }
    .module-medium { max-width: 400px; }
    .module-large { max-width: 500px; }
    button { background: #007bff; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #0056b3; }
    select, input[type="text"], input[type="number"], input[type="file"], textarea { background: #333; color: #e0e0e0; border: 1px solid #444; padding: 5px; border-radius: 5px; }
    .absolute { background: #1a1a1a; --accent: #ff5555; --accent-dark: #cc0000; }
    .recon { background: #1a1a1a; --accent: #55aaff; --accent-dark: #336699; }
    .hunter { background: #1a1a1a; --accent: #55ff55; --accent-dark: #33cc33; }
    button.accent { background: var(--accent); }
    button.accent:hover { background: var(--accent-dark); }
    .tooltip { position: relative; }
    .tooltip:hover::after {
      content: attr(data-tooltip); position: absolute; background: #333; color: #e0e0e0; padding: 5px; border-radius: 3px; z-index: 10; top: 100%; left: 0; width: 200px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="nav-bar">
      <button class="accent button-medium" onclick="toggleModule('rule-module')">–ü—Ä–∞–≤–∏–ª–æ –¥–Ω—è</button>
      <button class="accent button-medium" onclick="toggleModule('plan-module')">–ü–ª–∞–Ω –¥–Ω—è</button>
      <button class="accent button-medium" onclick="toggleModule('environment-module')">–û–∫—Ä—É–∂–µ–Ω–∏–µ</button>
      <button class="accent button-medium" onclick="toggleModule('finance-module')">–§–∏–Ω–∞–Ω—Å—ã</button>
      <button class="accent button-medium" onclick="toggleModule('fitness-module')">–§–∏–∑–æ</button>
      <button class="accent button-medium" onclick="toggleModule('strategy-module')">–ö–∞—Ä—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</button>
      <button class="accent button-medium" onclick="toggleModule('habits-module')">–ü—Ä–∏–≤—ã—á–∫–∏</button>
      <button class="accent button-medium" onclick="toggleModule('notes-module')">–ó–∞–º–µ—Ç–∫–∏</button>
      <button class="accent button-medium" onclick="toggleModule('knowledge-module')">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</button>
      <button class="accent button-medium" onclick="toggleModule('archetype-module')">–ê—Ä—Ö–µ—Ç–∏–ø—ã</button>
      <button class="accent button-medium" onclick="toggleModule('analytics-module')">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
      <button class="accent button-medium" onclick="toggleModule('settings-module')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      <button class="accent button-medium" onclick="toggleModule('help-module')">–°–ø—Ä–∞–≤–∫–∞</button>
    </div>
    <div class="critical-notification" id="critical-notification"></div>

    <!-- –ü—Ä–∞–≤–∏–ª–æ –¥–Ω—è -->
    <div class="module always-open module-medium" id="rule-module">
      <div class="module-header">
        <h2>üìú –ü—Ä–∞–≤–∏–ª–æ –¥–Ω—è</h2>
      </div>
      <div class="module-content">
        <div id="rule-text"></div>
        <div class="rule-actions">
          <button class="button-medium" onclick="adhereRule()">–ü—Ä–∏–¥–µ—Ä–∂–∞–ª—Å—è</button>
          <button class="button-medium" onclick="violateRule()">–ù–∞—Ä—É—à–∏–ª</button>
        </div>
        <input type="text" id="custom-rule" placeholder="–î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—ë –ø—Ä–∞–≤–∏–ª–æ" data-tooltip="–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ—ë –ø—Ä–∞–≤–∏–ª–æ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ">
        <button class="button-medium" onclick="addCustomRule()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <div class="error" id="rule-error"></div>
      </div>
    </div>

    <!-- –ü–ª–∞–Ω –¥–Ω—è -->
    <div class="module always-open module-medium" id="plan-module">
      <div class="module-header">
        <h2>üìã –ü–ª–∞–Ω –¥–Ω—è</h2>
      </div>
      <div class="module-content">
        <input type="text" id="plan-text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞—á—É" data-tooltip="–î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–∞—á—É –Ω–∞ –¥–µ–Ω—å">
        <select id="plan-priority">
          <option value="low">–ù–∏–∑–∫–∏–π</option>
          <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
          <option value="high">–í—ã—Å–æ–∫–∏–π</option>
        </select>
        <button class="button-medium" onclick="addPlan()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <div class="error" id="plan-error"></div>
        <ul id="plan-list"></ul>
      </div>
    </div>

    <!-- –û–∫—Ä—É–∂–µ–Ω–∏–µ -->
    <div class="module collapsed module-medium" id="environment-module">
      <div class="module-header" onclick="toggleModule('environment-module')">
        <h2>üë• –û–∫—Ä—É–∂–µ–Ω–∏–µ</h2>
        <span>‚ñº</span>
      </div>
      <div class="module-content">
        <button class="button-medium" onclick="openPersonModal()">–î–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞</button>
        <div class="error" id="environment-error"></div>
        <div id="people-list"></div>
        <div id="network-graph"></div>
      </div>
    </div>

    <!-- –§–∏–Ω–∞–Ω—Å—ã -->
    <div class="module collapsed module-medium" id="finance-module">
      <div class="module-header" onclick="toggleModule('finance-module')">
        <h2>üí∏ –§–∏–Ω–∞–Ω—Å—ã</h2>
        <span>‚ñº</span>
      </div>
      <div class="module-content">
        <div class="finance-container">
          <input type="number" id="finance-amount" placeholder="–°—É–º–º–∞" data-tooltip="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–æ—Ö–æ–¥–∞ –∏–ª–∏ —Ä–∞—Å—Ö–æ–¥–∞">
          <select id="finance-type">
            <option value="income">–î–æ—Ö–æ–¥</option>
            <option value="expense">–†–∞—Å—Ö–æ–¥</option>
          </select>
          <input type="text" id="finance-tag" placeholder="–¢–µ–≥" data-tooltip="–ù–∞–ø—Ä–∏–º–µ—Ä: –∑–∞—Ä–ø–ª–∞—Ç–∞, –µ–¥–∞, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç">
          <button class="button-medium" onclick="addTransaction()">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        <div class="error" id="finance-error"></div>
        <canvas id="finance-chart"></canvas>
        <ul id="finance-list"></ul>
      </div>
    </div>

    <!-- –ê—Ä—Ö–µ—Ç–∏–ø—ã -->
    <div class="module collapsed module-medium" id="archetype-module">
      <div class="module-header" onclick="toggleModule('archetype-module')">
        <h2>üß† –ê—Ä—Ö–µ—Ç–∏–ø—ã</h2>
        <span>‚ñº</span>
      </div>
      <div class="module-content">
        <button class="button-medium" onclick="openArchetypeModal()">–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</button>
        <div id="archetype-result"></div>
        <div class="error" id="archetype-error"></div>
      </div>
    </div>

    <!-- –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π -->
    <div class="module collapsed module-medium" id="knowledge-module">
      <div class="module-header" onclick="toggleModule('knowledge-module')">
        <h2>üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</h2>
        <span>‚ñº</span>
      </div>
      <div class="module-content">
        <input type="text" id="knowledge-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º/—Ç–µ–≥–∞–º" data-tooltip="–ò—â–∏—Ç–µ –ø–æ —Ç–µ–≥–∞–º –∏–ª–∏ —Å–ª–æ–≤–∞–º">
        <button class="button-medium" onclick="openKnowledgeModal()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</button>
        <div class="error" id="knowledge-error"></div>
        <ul id="knowledge-list"></ul>
      </div>
    </div>

    <!-- –°–ø—Ä–∞–≤–∫–∞ -->
    <div class="module collapsed module-medium" id="help-module">
      <div class="module-header" onclick="toggleModule('help-module')">
        <h2>üìö –°–ø—Ä–∞–≤–∫–∞</h2>
        <span>‚ñº</span>
      </div>
      <div class="module-content">
        <div id="help-content"></div>
        <div class="error" id="help-error"></div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <template id="person-modal-template">
      <div class="modal-content">
        <h2>–î–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞</h2>
        <input type="text" id="person-name" placeholder="–ò–º—è" data-tooltip="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —á–µ–ª–æ–≤–µ–∫–∞">
        <select id="person-status">
          <option value="loyal">üü¢ –õ–æ—è–ª—å–Ω—ã–π</option>
          <option value="neutral">üü° –ù–µ–π—Ç—Ä–∞–ª</option>
          <option value="hostile">üî¥ –í—Ä–∞–≥</option>
          <option value="contract">‚úçÔ∏è –ö–æ–Ω—Ç—Ä–∞–∫—Ç</option>
        </select>
        <input type="text" id="person-tags" placeholder="–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)" data-tooltip="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–µ—Å—É—Ä—Å, –ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä">
        <input type="number" id="person-karma" placeholder="–ö–∞—Ä–º–∞ (-100 –¥–æ +100)" data-tooltip="–ö–∞—Ä–º–∞ <-50 = –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—Ä–∞–≥">
        <button class="button-medium" onclick="addPerson()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <button class="button-medium" onclick="closeModal('person-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
        <div class="error" id="person-modal-error"></div>
      </div>
    </template>
    <template id="knowledge-modal-template">
      <div class="modal-content">
        <h2>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</h2>
        <input type="text" id="knowledge-title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" data-tooltip="–ö—Ä–∞—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏">
        <textarea id="knowledge-content" placeholder="–°–æ–¥–µ—Ä–∂–∏–º–æ–µ" data-tooltip="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ –∏–¥–µ—è"></textarea>
        <input type="text" id="knowledge-tags" placeholder="–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)" data-tooltip="–¢–µ–≥–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä: –∏–¥–µ—è, –ø—Ä–æ–µ–∫—Ç">
        <button class="button-medium" onclick="addKnowledge()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <button class="button-medium" onclick="closeModal('knowledge-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
        <div class="error" id="knowledge-modal-error"></div>
      </div>
    </template>
    <template id="archetype-modal-template">
      <div class="modal-content">
        <h2>–¢–µ—Å—Ç –∞—Ä—Ö–µ—Ç–∏–ø–∞</h2>
        <div id="archetype-progress"></div>
        <div id="archetype-questions"></div>
        <button class="button-medium" onclick="submitArchetype()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <button class="button-medium" onclick="closeModal('archetype-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
        <div class="error" id="archetype-modal-error"></div>
      </div>
    </template>
  </div>

  <script src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
  <script src="/utils.js"></script>
  <script src="/ruleOfDay.js"></script>
  <script src="/plan.js"></script>
  <script src="/environment.js"></script>
  <script src="/finance.js"></script>
  <script src="/archetype.js"></script>
  <script src="/knowledge.js"></script>
  <script src="/help.js"></script>
</body>
</html>