<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</title>
  <link rel="manifest" href="/manifest.json">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f4f4f4; }
    .module { margin-bottom: 20px; padding: 15px; background: white; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    h2 { margin-top: 0; }
    input, select, button { padding: 8px; margin: 5px; border-radius: 3px; border: 1px solid #ccc; }
    button { background: #007bff; color: white; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
    ul { list-style: none; padding: 0; }
    li { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
    .error { color: red; font-size: 0.8em; }
    .profile-card { display: flex; align-items: center; padding: 10px; border: 1px solid #ddd; margin-bottom: 10px; }
    .profile-card img { width: 50px; height: 50px; border-radius: 50%; margin-right: 10px; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    .modal-content { background: white; padding: 20px; border-radius: 5px; max-width: 90%; max-height: 90%; overflow-y: auto; }
    .modal.active { display: flex; }
    canvas { max-width: 100%; }
    .finance-container { display: flex; justify-content: space-between; }
    .finance-column { width: 48%; }
    .strategy-tree { display: flex; flex-direction: column; align-items: center; }
    .strategy-node { padding: 10px; border: 1px solid #ddd; margin: 5px; border-radius: 5px; }
    .strategy-branch { display: flex; justify-content: space-around; width: 100%; }
  </style>
</head>
<body>
  <!-- –û–∫—Ä—É–∂–µ–Ω–∏–µ -->
  <div class="module" id="environment-module">
    <h2>–û–∫—Ä—É–∂–µ–Ω–∏–µ</h2>
    <input type="text" id="person-name" placeholder="–ò–º—è —á–µ–ª–æ–≤–µ–∫–∞">
    <select id="person-status">
      <option value="loyal">–õ–æ—è–ª—å–Ω—ã–π</option>
      <option value="neutral">–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π</option>
      <option value="hostile">–í—Ä–∞–∂–¥–µ–±–Ω—ã–π</option>
    </select>
    <select id="person-tags" multiple>
      <option value="üí∞ –†–µ—Å—É—Ä—Å">üí∞ –†–µ—Å—É—Ä—Å</option>
      <option value="ü™® –ë–∞–ª–ª–∞—Å—Ç">ü™® –ë–∞–ª–ª–∞—Å—Ç</option>
    </select>
    <input type="number" id="person-karma" placeholder="–ö–∞—Ä–º–∞ (0)" value="0">
    <select id="person-connections" multiple>
      <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤—è–∑–∏</option>
    </select>
    <button onclick="addPerson()">–î–æ–±–∞–≤–∏—Ç—å</button>
    <div class="error" id="environment-error"></div>
    <ul id="person-list"></ul>
  </div>

  <!-- –î–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã -->
  <div class="module" id="finance-module">
    <h2>–î–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã</h2>
    <div class="finance-container">
      <div class="finance-column">
        <h3>–î–æ—Ö–æ–¥—ã</h3>
        <input type="number" id="income-amount" placeholder="–°—É–º–º–∞">
        <input type="text" id="income-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
        <button onclick="addTransaction('income')">–ó–∞–ø–∏—Å–∞—Ç—å</button>
        <ul id="income-list"></ul>
      </div>
      <div class="finance-column">
        <h3>–†–∞—Å—Ö–æ–¥—ã</h3>
        <input type="number" id="expense-amount" placeholder="–°—É–º–º–∞">
        <input type="text" id="expense-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
        <button onclick="addTransaction('expense')">–ó–∞–ø–∏—Å–∞—Ç—å</button>
        <ul id="expense-list"></ul>
      </div>
    </div>
    <div id="finance-percentage"></div>
    <canvas id="finance-chart"></canvas>
    <div class="error" id="finance-error"></div>
  </div>

  <!-- –ö–∞—Ä—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ -->
  <div class="module" id="strategy-module">
    <h2>–ö–∞—Ä—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</h2>
    <button onclick="openStrategyModal()">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</button>
    <div class="error" id="strategy-error"></div>
    <div id="strategy-list" class="strategy-tree"></div>
  </div>

  <!-- –¢–µ–Ω–µ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
  <div class="module" id="analytics-module">
    <h2>–¢–µ–Ω–µ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
    <button onclick="window.renderAnalytics()">–û–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É</button>
    <div id="analytics-results"></div>
    <div class="error" id="analytics-error"></div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ -->
  <template id="strategy-modal-template">
    <div class="modal" id="strategy-modal">
      <div class="modal-content">
        <h2>–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</h2>
        <input type="text" id="strategy-goal" placeholder="–¶–µ–ª—å">
        <select id="strategy-people">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —á–µ–ª–æ–≤–µ–∫–∞</option>
        </select>
        <button onclick="addStrategy()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <button onclick="closeModal('strategy-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
        <div class="error" id="strategy-modal-error"></div>
      </div>
    </div>
  </template>

  <script>
    // –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
    function showError(module, message) {
      const errorDiv = document.getElementById(`${module}-error`);
      if (errorDiv) {
        errorDiv.textContent = message;
        console.log(`–û—à–∏–±–∫–∞ –≤ ${module}: ${message}`);
      }
    }

    function openModal(templateId, modalId) {
      const template = document.getElementById(templateId);
      if (template) {
        const modal = template.content.cloneNode(true).querySelector('.modal');
        modal.id = modalId;
        document.body.appendChild(modal);
        modal.classList.add('active');
      } else {
        console.error(`–®–∞–±–ª–æ–Ω ${templateId} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
      }
    }

    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) modal.remove();
    }

    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
    window.renderAnalytics = () => {
      try {
        const analyticsResults = document.getElementById('analytics-results');
        if (!analyticsResults) {
          console.error('–≠–ª–µ–º–µ–Ω—Ç analytics-results –Ω–µ –Ω–∞–π–¥–µ–Ω');
          return;
        }
        const people = JSON.parse(localStorage.getItem('people') || '[]');
        const transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
        let results = '<h3>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h3><ul>';

        const negativeKarma = people.filter(p => p.karma < 0);
        results += negativeKarma.length > 0
          ? `<li>–õ—é–¥–∏ —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π –∫–∞—Ä–º–æ–π: ${negativeKarma.map(p => `${p.name} (${p.karma})`).join(', ')}</li>`
          : '<li>–ù–µ—Ç –ª—é–¥–µ–π —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π –∫–∞—Ä–º–æ–π</li>';

        const last30Days = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
        const recentTransactions = transactions.filter(t => new Date(t.date) >= last30Days);
        const income = recentTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
        const expense = recentTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
        const total = income + expense;
        const percentage = total ? (income / total * 100).toFixed(2) : 0;
        results += `<li>–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${percentage}%</li>`;

        analyticsResults.innerHTML = results;
        console.log('–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
        showError('analytics', '');
      } catch (e) {
        showError('analytics', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:', e);
      }
    };

    // –û–∫—Ä—É–∂–µ–Ω–∏–µ
    function initEnvironment() {
      try {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è –û–∫—Ä—É–∂–µ–Ω–∏–µ');
        const personName = document.getElementById('person-name');
        const personStatus = document.getElementById('person-status');
        const personTags = document.getElementById('person-tags');
        const personKarma = document.getElementById('person-karma');
        const personConnections = document.getElementById('person-connections');
        const personList = document.getElementById('person-list');
        let people = JSON.parse(localStorage.getItem('people') || '[]');

        const renderPeople = () => {
          try {
            personList.innerHTML = '';
            people.forEach((person, index) => {
              const tagsDisplay = person.tags.length > 0 ? person.tags.join(', ') : '–Ω–µ—Ç';
              const connectionsDisplay = person.connections.length > 0 ? person.connections.join(', ') : '–Ω–µ—Ç';
              const li = document.createElement('li');
              li.className = 'profile-card';
              li.innerHTML = `
                <div>
                  <strong>${person.name}</strong> (${person.status}, –ö–∞—Ä–º–∞: ${person.karma})<br>
                  –ú–µ—Ç–∫–∏: ${tagsDisplay}<br>
                  –°–≤—è–∑–∏: ${connectionsDisplay}<br>
                  <button onclick="deletePerson(${index})">‚ùå</button>
                </div>
              `;
              personList.appendChild(li);
            });
            updateConnectionsSelect();
            if (window.updateStrategyPeopleSelect) window.updateStrategyPeopleSelect();
            window.renderAnalytics();
            showError('environment', '');
            console.log('–°–ø–∏—Å–æ–∫ –ª—é–¥–µ–π –æ—Ç–æ–±—Ä–∞–∂—ë–Ω:', people);
          } catch (e) {
            showError('environment', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –ª—é–¥–µ–π:', e);
          }
        };

        const updateConnectionsSelect = () => {
          try {
            personConnections.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤—è–∑–∏</option>';
            people.forEach(person => {
              const option = document.createElement('option');
              option.value = person.name;
              option.textContent = person.name;
              personConnections.appendChild(option);
            });
            console.log('–°–≤—è–∑–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
          } catch (e) {
            showError('environment', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å–≤—è–∑–∏: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≤—è–∑–µ–π:', e);
          }
        };

        window.addPerson = () => {
          try {
            const name = personName.value.trim();
            const status = personStatus.value;
            const tags = Array.from(personTags.selectedOptions).map(opt => opt.value);
            const karma = parseInt(personKarma.value) || 0;
            const connections = Array.from(personConnections.selectedOptions).map(opt => opt.value);
            if (name) {
              people.push({ name, status, tags, karma, connections });
              localStorage.setItem('people', JSON.stringify(people));
              personName.value = '';
              personStatus.value = 'loyal';
              Array.from(personTags.options).forEach(option => option.selected = false);
              personKarma.value = '0';
              Array.from(personConnections.options).forEach(option => option.selected = false);
              renderPeople();
              console.log('–î–æ–±–∞–≤–ª–µ–Ω —á–µ–ª–æ–≤–µ–∫:', { name, status, tags, karma, connections });
            } else {
              showError('environment', '–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
            }
          } catch (e) {
            showError('environment', '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–∞:', e);
          }
        };

        window.deletePerson = (index) => {
          try {
            const name = people[index].name;
            people.splice(index, 1);
            localStorage.setItem('people', JSON.stringify(people));
            renderPeople();
            console.log('–£–¥–∞–ª—ë–Ω —á–µ–ª–æ–≤–µ–∫:', name);
          } catch (e) {
            showError('environment', '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–∞:', e);
          }
        };

        renderPeople();
        updateConnectionsSelect();
        console.log('–û–∫—Ä—É–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
      } catch (e) {
        showError('environment', '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –û–∫—Ä—É–∂–µ–Ω–∏—è:', e);
      }
    }

    // –î–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã
    function initFinance() {
      try {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è –î–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã');
        const incomeAmount = document.getElementById('income-amount');
        const incomeDescription = document.getElementById('income-description');
        const expenseAmount = document.getElementById('expense-amount');
        const expenseDescription = document.getElementById('expense-description');
        const incomeList = document.getElementById('income-list');
        const expenseList = document.getElementById('expense-list');
        const percentageText = document.getElementById('finance-percentage');
        const financeChart = document.getElementById('finance-chart').getContext('2d');
        let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');
        let chart;

        const renderTransactions = () => {
          try {
            incomeList.innerHTML = '';
            expenseList.innerHTML = '';
            const last30Days = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);
            const recentTransactions = transactions.filter(t => new Date(t.date) >= last30Days);

            recentTransactions.forEach((transaction, index) => {
              const li = document.createElement('li');
              li.innerHTML = `${transaction.amount} - ${transaction.description} <button onclick="deleteTransaction(${index})">‚ùå</button>`;
              if (transaction.type === 'income') {
                incomeList.appendChild(li);
              } else {
                expenseList.appendChild(li);
              }
            });

            const income = recentTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const expense = recentTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
            const total = income + expense;
            const percentage = total ? (income / total * 100).toFixed(2) : 0;
            percentageText.textContent = `–î–æ—Ö–æ–¥—ã: ${income} | –†–∞—Å—Ö–æ–¥—ã: ${expense} | ${percentage}%`;
            percentageText.style.color = percentage > 50 ? 'green' : percentage == 50 ? 'yellow' : 'red';

            updateFinanceChart();
            window.renderAnalytics();
            showError('finance', '');
            console.log('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã:', transactions);
          } catch (e) {
            showError('finance', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:', e);
          }
        };


const updateFinanceChart = () => {
          try {
            const dates = [...new Set(transactions.map(t => new Date(t.date).toLocaleDateString()))];
            const incomeData = dates.map(date => {
              return transactions
                .filter(t => t.type === 'income' && new Date(t.date).toLocaleDateString() === date)
                .reduce((sum, t) => sum + t.amount, 0);
            });
            const expenseData = dates.map(date => {
              return transactions
                .filter(t => t.type === 'expense' && new Date(t.date).toLocaleDateString() === date)
                .reduce((sum, t) => sum + t.amount, 0);
            });

            if (chart) chart.destroy();
            chart = new Chart(financeChart, {
              type: 'line',
              data: {
                labels: dates,
                datasets: [
                  { label: '–î–æ—Ö–æ–¥—ã', data: incomeData, borderColor: 'green', fill: false },
                  { label: '–†–∞—Å—Ö–æ–¥—ã', data: expenseData, borderColor: 'red', fill: false }
                ]
              },
              options: { scales: { y: { beginAtZero: true } } }
            });
            console.log('–ì—Ä–∞—Ñ–∏–∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤ –æ–±–Ω–æ–≤–ª—ë–Ω');
          } catch (e) {
            showError('finance', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞:', e);
          }
        };

        window.addTransaction = (type) => {
          try {
            const amount = parseFloat(type === 'income' ? incomeAmount.value : expenseAmount.value);
            const description = (type === 'income' ? incomeDescription.value : expenseDescription.value).trim();
            if (!isNaN(amount) && amount > 0 && description) {
              transactions.push({ amount, type, description, date: new Date().toISOString() });
              localStorage.setItem('transactions', JSON.stringify(transactions));
              if (type === 'income') {
                incomeAmount.value = '';
                incomeDescription.value = '';
              } else {
                expenseAmount.value = '';
                expenseDescription.value = '';
              }
              renderTransactions();
              console.log(`–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: ${type}, ${amount}`);
            } else {
              showError('finance', '–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É (>0) –∏ –æ–ø–∏—Å–∞–Ω–∏–µ');
            }
          } catch (e) {
            showError('finance', '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:', e);
          }
        };

        window.deleteTransaction = (index) => {
          try {
            const transaction = transactions[index];
            transactions.splice(index, 1);
            localStorage.setItem('transactions', JSON.stringify(transactions));
            renderTransactions();
            console.log(`–£–¥–∞–ª–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è: ${transaction.type}, ${transaction.amount}`);
          } catch (e) {
            showError('finance', '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:', e);
          }
        };

        renderTransactions();
        console.log('–î–æ—Ö–æ–¥—ã –∏ —Ä–∞—Å—Ö–æ–¥—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
      } catch (e) {
        showError('finance', '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –§–∏–Ω–∞–Ω—Å–æ–≤:', e);
      }
    }

    // –ö–∞—Ä—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    function initStrategy() {
      try {
        console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è –ö–∞—Ä—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏');
        const strategyList = document.getElementById('strategy-list');
        let strategies = JSON.parse(localStorage.getItem('strategies') || '[]');

        window.updateStrategyPeopleSelect = () => {
          try {
            const peopleSelect = document.getElementById('strategy-people');
            if (!peopleSelect) return;
            const people = JSON.parse(localStorage.getItem('people') || '[]');
            peopleSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —á–µ–ª–æ–≤–µ–∫–∞</option>';
            people.forEach(person => {
              const option = document.createElement('option');
              option.value = person.name;
              option.textContent = person.name;
              peopleSelect.appendChild(option);
            });
            console.log('–°–ø–∏—Å–æ–∫ –ª—é–¥–µ–π –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –æ–±–Ω–æ–≤–ª—ë–Ω');
          } catch (e) {
            showError('strategy', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ª—é–¥–µ–π: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ª—é–¥–µ–π:', e);
          }
        };

        const renderStrategies = () => {
          try {
            strategyList.innerHTML = '';
            strategies.forEach((strategy, index) => {
              const div = document.createElement('div');
              div.className = 'strategy-node';
              div.innerHTML = `
                <strong>–¶–µ–ª—å: ${strategy.goal}</strong> (–õ—é–¥–∏: ${strategy.people || '–Ω–µ—Ç'})<br>
                <button onclick="deleteStrategy(${index})">‚ùå</button>
              `;
              strategyList.appendChild(div);
            });
            window.renderAnalytics();
            showError('strategy', '');
            console.log('–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã:', strategies);
          } catch (e) {
            showError('strategy', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π:', e);
          }
        };

        window.addStrategy = () => {
          try {
            const goal = document.getElementById('strategy-goal').value.trim();
            const people = document.getElementById('strategy-people').value;
            if (goal) {
              strategies.push({ goal, people });
              localStorage.setItem('strategies', JSON.stringify(strategies));
              document.getElementById('strategy-goal').value = '';
              document.getElementById('strategy-people').value = '';
              renderStrategies();
              closeModal('strategy-modal');
              console.log('–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:', goal);
            } else {
              showError('strategy-modal', '–í–≤–µ–¥–∏—Ç–µ —Ü–µ–ª—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏');
            }
          } catch (e) {
            showError('strategy-modal', '–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:', e);
          }
        };

        window.deleteStrategy = (index) => {
          try {
            const goal = strategies[index].goal;
            strategies.splice(index, 1);
            localStorage.setItem('strategies', JSON.stringify(strategies));
            renderStrategies();
            console.log('–£–¥–∞–ª–µ–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:', goal);
          } catch (e) {
            showError('strategy', '–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é: ' + e.message);
            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:', e);
          }
        };

        window.updateStrategyPeopleSelect();
        renderStrategies();
        console.log('–ö–∞—Ä—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
      } catch (e) {
        showError('strategy', '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –°—Ç—Ä–∞—Ç–µ–≥–∏–π:', e);
      }
    }

    function openStrategyModal() {
      try {
        openModal('strategy-modal-template', 'strategy-modal');
        window.updateStrategyPeopleSelect();
        showError('strategy-modal', '');
      } catch (e) {
        showError('strategy-modal', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: ' + e.message);
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:', e);
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', () => {
      console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é');
      initEnvironment();
      initFinance();
      initStrategy();
      console.log('–í—Å–µ –º–æ–¥—É–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
    });
  </script>
</body>
</html>