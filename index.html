<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>BlackTrigger HQ</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1a1a1a">
  <style>
    body { margin: 0; padding: 0; width: 100%; height: 100vh; background: #1a1a1a; color: #e0e0e0; font-family: Arial, sans-serif; }
    .container { width: 100%; height: 100%; padding: 10px; box-sizing: border-box; }
    .nav-bar { display: flex; flex-wrap: wrap; justify-content: space-around; background: #222; padding: 10px; margin-bottom: 20px; border-radius: 5px; }
    .module { border: 1px solid #444; margin: 10px 0; border-radius: 5px; }
    .module-header { padding: 10px; background: #333; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
    .module-content { padding: 10px; display: none; }
    .module.always-open .module-content { display: block; }
    .module:not(.collapsed) .module-content { display: block; }
    .error { color: #ff5555; margin: 10px 0; }
    button { background: #007bff; color: #fff; border: none; border-radius: 5px; cursor: pointer; padding: 10px; }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>
  <div class="container">
    <div class="nav-bar">
      <button onclick="toggleModule('rule-module')">Правило День</button>
      <button onclick="toggleModule('plan-module')">План День</button>
      <button onclick="toggleModule('environment-module')">Окружение</button>
      <button onclick="toggleModule('finance-module')">Финансы</button>
      <button onclick="toggleModule('habits-module')">Привычки</button>
      <button onclick="toggleModule('notes-module')">Заметки</button>
      <button onclick="toggleModule('knowledge-module')">База знаний</button>
      <button onclick="toggleModule('archetype-module')">Архетипы</button>
      <button onclick="toggleModule('analytics-module')">Аналитика</button>
      <button onclick="toggleModule('settings-module')">Настройки</button>
      <button onclick="toggleModule('help-module')">Справка</button>
      <button onclick="toggleModule('strategy-module')">Карта стратегии</button>
    </div>

    <div class="module always-open" id="rule-module">
      <div class="module-header">
        <h2>Правило День</h2>
      </div>
      <div class="module-content">
        <div id="rule-text"></div>
        <button onclick="adhereRule()">Придержался</button>
        <button onclick="violateRule()">Нарушил</button>
        <input type="text" id="custom-rule" placeholder="Добавить правило">
        <button onclick="addCustomRule()">Добавить</button>
        <div class="error" id="rule-error"></div>
      </div>
    </div>

    <div class="module always-open" id="plan-module">
      <div class="module-header">
        <h2>План День</h2>
      </div>
      <div class="module-content">
        <input type="text" id="plan-text" placeholder="Добавить план">
        <button onclick="addPlan()">Добавить</button>
        <div class="error" id="plan-error"></div>
        <ul id="plan-list"></ul>
      </div>
    </div>

    <!-- Другие модули упрощены для теста -->
    <div class="module collapsed" id="environment-module">
      <div class="module-header" onclick="toggleModule('environment-module')">
        <h2>Окружение</h2><span>▼</span>
      </div>
      <div class="module-content">
        <button onclick="openPersonModal()">Добавить</button>
        <div id="people-list"></div>
      </div>
    </div>

    <div class="module collapsed" id="finance-module">
      <div class="module-header" onclick="toggleModule('finance-module')">
        <h2>Финансы</h2><span>▼</span>
      </div>
      <div class="module-content">
        <button onclick="addTransaction()">Добавить</button>
        <ul id="finance-list"></ul>
      </div>
    </div>

    <div class="module collapsed" id="habits-module">
      <div class="module-header" onclick="toggleModule('habits-module')">
        <h2>Привычки</h2><span>▼</span>
      </div>
      <div class="module-content">
        <button onclick="addHabit()">Добавить</button>
        <ul id="habit-list"></ul>
      </div>
    </div>

    <div class="module collapsed" id="notes-module">
      <div class="module-header" onclick="toggleModule('notes-module')">
        <h2>Заметки</h2><span>▼</span>
      </div>
      <div class="module-content">
        <button onclick="addNote()">Добавить</button>
        <ul id="note-list"></ul>
      </div>
    </div>

    <div class="module collapsed" id="knowledge-module">
      <div class="module-header" onclick="toggleModule('knowledge-module')">
        <h2>База знаний</h2><span>▼</span>
      </div>
      <div class="module-content">
        <button onclick="openKnowledgeModal()">Добавить</button>
        <ul id="knowledge-list"></ul>
      </div>
    </div>

    <div class="module collapsed" id="archetype-module">
      <div class="module-header" onclick="toggleModule('archetype-module')">
        <h2>Архетипы</h2><span>▼</span>
      </div>
      <div class="module-content">
        <button onclick="openArchetypeModal()">Добавить</button>
        <div id="archetype-result"></div>
      </div>
    </div>

    <div class="module collapsed" id="analytics-module">
      <div class="module-header" onclick="toggleModule('analytics-module')">
        <h2>Аналитика</h2><span>▼</span>
      </div>
      <div class="module-content">
        <button onclick="accessAnalytics()">Добавить</button>
        <div id="analytics-results"></div>
      </div>
    </div>

    <div class="module collapsed" id="settings-module">
      <div class="module-header" onclick="toggleModule('settings-module')">
        <h2>Настройки</h2><span>▼</span>
      </div>
      <div class="module-content">
        <button onclick="exportData()">Экспорт</button>
        <button onclick="importData()">Импорт</button>
      </div>
    </div>

    <div class="module collapsed" id="help-module">
      <div class="module-header" onclick="toggleModule('help-module')">
        <h2>Справка</h2><span>▼</span>
      </div>
      <div class="module-content">
        <div id="help-content"></div>
      </div>
    </div>

    <div class="module collapsed" id="strategy-module">
      <div class="module-header" onclick="toggleModule('strategy-module')">
        <h2>Карта стратегии</h2><span>▼</span>
      </div>
      <div class="module-content">
        <button onclick="openStrategyModal()">Добавить</button>
        <div id="strategy-list"></div>
      </div>
    </div>

    <template id="person-modal-template">
      <div class="modal-content">
        <h2>Добавить человека</h2>
        <input type="text" id="person-name" placeholder="Имя">
        <button onclick="addPerson()">Добавить</button>
        <button onclick="closeModal('person-modal')">Закрыть</button>
      </div>
    </template>
    <template id="strategy-modal-template">
      <div class="modal-content">
        <h2>Добавить стратегию</h2>
        <input type="text" id="strategy-goal" placeholder="Цель">
        <button onclick="addStrategy()">Добавить</button>
        <button onclick="closeModal('strategy-modal')">Закрыть</button>
      </div>
    </template>
    <template id="knowledge-modal-template">
      <div class="modal-content">
        <h2>Добавить заметку</h2>
        <input type="text" id="knowledge-title" placeholder="Заголовок">
        <button onclick="addKnowledge()">Добавить</button>
        <button onclick="closeModal('knowledge-modal')">Закрыть</button>
      </div>
    </template>
    <template id="archetype-modal-template">
      <div class="modal-content">
        <h2>Тест архетипа</h2>
        <button onclick="submitArchetype()">Отправить</button>
        <button onclick="closeModal('archetype-modal')">Закрыть</button>
      </div>
    </template>
  </div>

  <script src="/utils.js"></script>
  <script src="/ruleOfDay.js"></script>
  <script src="/plan.js"></script>
  <script src="/environment.js"></script>
  <script src="/strategy.js"></script>
  <script src="/habits.js"></script>
  <script src="/notes.js"></script>
  <script src="/knowledge.js"></script>
  <script src="/archetype.js"></script>
  <script src="/help.js"></script>
</body>
</html>