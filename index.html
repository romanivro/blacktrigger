<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>BlackTrigger HQ</title>
  <style>
    body { margin: 0; padding: 0; width: 100%; height: 100vh; background: #1a1a1a; color: #e0e0e0; font-family: Arial, sans-serif; }
    .container { width: 100%; height: 100%; padding: 10px; box-sizing: border-box; overflow-y: auto; }
    .nav-bar { display: flex; flex-wrap: wrap; justify-content: space-around; background: #222; padding: 10px; margin-bottom: 20px; border-radius: 5px; }
    .module { border: 1px solid #444; margin: 10px 0; border-radius: 5px; }
    .module-header { padding: 10px; background: #333; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
    .module-content { padding: 10px; display: none; }
    .module.always-open .module-content { display: block; }
    .module:not(.collapsed) .module-content { display: block; }
    .error { color: #ff5555; margin: 10px 0; }
    button { background: #007bff; color: #fff; border: none; border-radius: 5px; cursor: pointer; padding: 10px; margin: 5px 0; }
    button:hover { background: #0056b3; }
    input, select, textarea { background: #333; color: #e0e0e0; border: 1px solid #444; padding: 5px; border-radius: 5px; width: 100%; box-sizing: border-box; margin: 5px 0; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
    .modal-content { background: #333; padding: 20px; margin: 10% auto; width: 80%; max-width: 600px; border-radius: 5px; overflow-y: auto; max-height: 80%; }
    .modal.show { display: block; }
    ul { list-style: none; padding: 0; }
    li { margin: 5px 0; }
    .stats { margin-top: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="nav-bar">
      <button onclick="toggleModule('rule-module')">–ü—Ä–∞–≤–∏–ª–æ –î–µ–Ω—å</button>
      <button onclick="toggleModule('plan-module')">–ü–ª–∞–Ω –î–µ–Ω—å</button>
      <button onclick="toggleModule('environment-module')">–û–∫—Ä—É–∂–µ–Ω–∏–µ</button>
      <button onclick="toggleModule('finance-module')">–§–∏–Ω–∞–Ω—Å—ã</button>
      <button onclick="toggleModule('habits-module')">–ü—Ä–∏–≤—ã—á–∫–∏</button>
      <button onclick="toggleModule('notes-module')">–ó–∞–º–µ—Ç–∫–∏</button>
      <button onclick="toggleModule('knowledge-module')">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</button>
      <button onclick="toggleModule('archetype-module')">–ê—Ä—Ö–µ—Ç–∏–ø—ã</button>
      <button onclick="toggleModule('analytics-module')">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
      <button onclick="toggleModule('settings-module')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      <button onclick="toggleModule('help-module')">–°–ø—Ä–∞–≤–∫–∞</button>
      <button onclick="toggleModule('strategy-module')">–ö–∞—Ä—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</button>
    </div>

    <!-- –ü—Ä–∞–≤–∏–ª–æ –î–µ–Ω—å -->
    <div class="module always-open" id="rule-module">
      <div class="module-header">
        <h2>üìú –ü—Ä–∞–≤–∏–ª–æ –î–µ–Ω—å</h2>
      </div>
      <div class="module-content">
        <div id="rule-text"></div>
        <button onclick="adhereRule()">–ü—Ä–∏–¥–µ—Ä–∂–∞–ª—Å—è</button>
        <button onclick="violateRule()">–ù–∞—Ä—É—à–∏–ª</button>
        <input type="text" id="custom-rule" placeholder="–î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—ë –ø—Ä–∞–≤–∏–ª–æ">
        <button onclick="addCustomRule()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <div class="error" id="rule-error"></div>
      </div>
    </div>

    <!-- –ü–ª–∞–Ω –Ω–∞ –î–µ–Ω—å -->
    <div class="module always-open" id="plan-module">
      <div class="module-header">
        <h2>üìã –ü–ª–∞–Ω –Ω–∞ –î–µ–Ω—å</h2>
      </div>
      <div class="module-content">
        <input type="text" id="plan-text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞—á—É">
        <button onclick="addPlan()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <ul id="plan-list"></ul>
        <div class="error" id="plan-error"></div>
      </div>
    </div>

    <!-- –û–∫—Ä—É–∂–µ–Ω–∏–µ -->
    <div class="module collapsed" id="environment-module">
      <div class="module-header" onclick="toggleModule('environment-module')">
        <h2>üë• –û–∫—Ä—É–∂–µ–Ω–∏–µ</h2><span>‚ñº</span>
      </div>
      <div class="module-content">
        <button onclick="openPersonModal()">–î–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞</button>
        <div id="people-list"></div>
      </div>
    </div>

    <!-- –§–∏–Ω–∞–Ω—Å—ã -->
    <div class="module collapsed" id="finance-module">
      <div class="module-header" onclick="toggleModule('finance-module')">
        <h2>üí∞ –§–∏–Ω–∞–Ω—Å—ã</h2><span>‚ñº</span>
      </div>
      <div class="module-content">
        <input type="number" id="finance-amount" placeholder="–°—É–º–º–∞">
        <select id="finance-type">
          <option value="income">–î–æ—Ö–æ–¥</option>
          <option value="expense">–†–∞—Å—Ö–æ–¥</option>
        </select>
        <button onclick="addTransaction()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <ul id="finance-list"></ul>
        <div class="stats" id="finance-stats"></div>
      </div>
    </div>

    <!-- –ü—Ä–∏–≤—ã—á–∫–∏ -->
    <div class="module collapsed" id="habits-module">
      <div class="module-header" onclick="toggleModule('habits-module')">
        <h2>üîÑ –ü—Ä–∏–≤—ã—á–∫–∏</h2><span>‚ñº</span>
      </div>
      <div class="module-content">
        <input type="text" id="habit-text" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–≤—ã—á–∫—É">
        <select id="habit-frequency">
          <option value="daily">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ</option>
          <option value="weekly">–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ</option>
        </select>
        <button onclick="addHabit()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <ul id="habit-list"></ul>
      </div>
    </div>

    <!-- –ó–∞–º–µ—Ç–∫–∏ -->
    <div class="module collapsed" id="notes-module">
      <div class="module-header" onclick="toggleModule('notes-module')">
        <h2>üìù –ó–∞–º–µ—Ç–∫–∏</h2><span>‚ñº</span>
      </div>
      <div class="module-content">
        <input type="text" id="note-text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É">
        <button onclick="addNote()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <ul id="note-list"></ul>
      </div>
    </div>

    <!-- –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π -->
    <div class="module collapsed" id="knowledge-module">
      <div class="module-header" onclick="toggleModule('knowledge-module')">
        <h2>üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</h2><span>‚ñº</span>
      </div>
      <div class="module-content">
        <input type="text" id="knowledge-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º" oninput="renderKnowledge()">
        <button onclick="openKnowledgeModal()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</button>
        <ul id="knowledge-list"></ul>
      </div>
    </div>

    <!-- –ê—Ä—Ö–µ—Ç–∏–ø—ã -->
    <div class="module collapsed" id="archetype-module">
      <div class="module-header" onclick="toggleModule('archetype-module')">
        <h2>üß† –ê—Ä—Ö–µ—Ç–∏–ø—ã</h2><span>‚ñº</span>
      </div>
      <div class="module-content">
        <button onclick="openArchetypeModal()">–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</button>
        <div id="archetype-result"></div>
      </div>
    </div>

    <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
    <div class="module collapsed" id="analytics-module">
      <div class="module-header" onclick="toggleModule('analytics-module')">
        <h2>üîç –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2><span>‚ñº</span>
      </div>
      <div class="module-content">
        <div id="analytics-results"></div>
      </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div class="module collapsed" id="settings-module">
      <div class="module-header" onclick="toggleModule('settings-module')">
        <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2><span>‚ñº</span>
      </div>
      <div class="module-content">
        <select id="state-select">
          <option value="focus">–í —Ñ–æ–∫—É—Å–µ</option>
          <option value="fatigue">–£—Å—Ç–∞–ª–æ—Å—Ç—å</option>
          <option value="rise">–ü–æ–¥—ä—ë–º</option>
        </select>
        <button onclick="applyState()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        <button onclick="exportData()">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
        <input type="file" id="import-file" accept=".json">
        <button onclick="importData()">–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
        <div class="error" id="settings-error"></div>
      </div>
    </div>

    <!-- –°–ø—Ä–∞–≤–∫–∞ -->
    <div class="module collapsed" id="help-module">
      <div class="module-header" onclick="toggleModule('help-module')">
        <h2>üìö –°–ø—Ä–∞–≤–∫–∞</h2><span>‚ñº</span>
      </div>
      <div class="module-content">
        <div id="help-content"></div>
      </div>
    </div>

    <!-- –ö–∞—Ä—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ -->
    <div class="module collapsed" id="strategy-module">
      <div class="module-header" onclick="toggleModule('strategy-module')">
        <h2>üó∫Ô∏è –ö–∞—Ä—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</h2><span>‚ñº</span>
      </div>
      <div class="module-content">
        <button onclick="openStrategyModal()">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</button>
        <div id="strategy-list"></div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <template id="person-modal-template">
      <div class="modal-content">
        <h2>–î–æ–±–∞–≤–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞</h2>
        <input type="text" id="person-name" placeholder="–ò–º—è">
        <select id="person-status">
          <option value="loyal">üü¢ –õ–æ—è–ª—å–Ω—ã–π</option>
          <option value="neutral">üü° –ù–µ–π—Ç—Ä–∞–ª</option>
          <option value="hostile">üî¥ –í—Ä–∞–≥</option>
          <option value="contract">‚úçÔ∏è –ö–æ–Ω—Ç—Ä–∞–∫—Ç</option>
        </select>
        <input type="text" id="person-tags" placeholder="–ú–µ—Ç–∫–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)">
        <button onclick="addPerson()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <button onclick="closeModal('person-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </template>
    <template id="knowledge-modal-template">
      <div class="modal-content">
        <h2>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</h2>
        <input type="text" id="knowledge-title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫">
        <textarea id="knowledge-content" placeholder="–°–æ–¥–µ—Ä–∂–∏–º–æ–µ"></textarea>
        <button onclick="addKnowledge()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <button onclick="closeModal('knowledge-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </template>
    <template id="strategy-modal-template">
      <div class="modal-content">
        <h2>–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</h2>
        <input type="text" id="strategy-goal" placeholder="–¶–µ–ª—å">
        <button onclick="addStrategy()">–î–æ–±–∞–≤–∏—Ç—å</button>
        <button onclick="closeModal('strategy-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </template>
    <template id="archetype-modal-template">
      <div class="modal-content">
        <h2>–¢–µ—Å—Ç –∞—Ä—Ö–µ—Ç–∏–ø–∞</h2>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç:</p>
        <select id="archetype-question">
          <option value="predator">–Ø –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–µ—à–∏—Ç–µ–ª—å–Ω–æ.</option>
          <option value="strategist">–Ø –ø–ª–∞–Ω–∏—Ä—É—é –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é.</option>
          <option value="provocateur">–Ø –ø—Ä–æ–≤–æ—Ü–∏—Ä—É—é –¥—Ä—É–≥–∏—Ö.</option>
        </select>
        <button onclick="submitArchetype()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <button onclick="closeModal('archetype-modal')">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </template>
  </div>

  <script>
    // –£—Ç–∏–ª–∏—Ç—ã
    function toggleModule(moduleId) {
      const module = document.getElementById(moduleId);
      if (!module.classList.contains('always-open')) {
        module.classList.toggle('collapsed');
      }
    }

    function showError(moduleId, message) {
      const errorElement = document.getElementById(`${moduleId}-error`);
      if (errorElement) errorElement.textContent = message;
    }

    function openModal(templateId, modalId) {
      const modal = document.createElement('div');
      modal.id = modalId;
      modal.className = 'modal';
      modal.innerHTML = document.getElementById(templateId).innerHTML;
      document.body.appendChild(modal);
      modal.classList.add('show');
    }

    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) modal.remove();
    }

    function exportData() {
      const data = {
        rule: localStorage.getItem('currentRule'),
        plans: localStorage.getItem('plans'),
        people: localStorage.getItem('people'),
        transactions: localStorage.getItem('transactions'),
        habits: localStorage.getItem('habits'),
        notes: localStorage.getItem('notes'),
        knowledge: localStorage.getItem('knowledge'),
        archetype: localStorage.getItem('archetype'),
        strategies: localStorage.getItem('strategies')
      };
      const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'blacktrigger-data.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function importData() {
      const fileInput = document.getElementById('import-file');
      if (fileInput.files.length === 0) {
        showError('settings', '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª');
        return;
      }
      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.onload = (e) => {
        const data = JSON.parse(e.target.result);
        for (const key in data) {
          if (data[key]) localStorage.setItem(key, data[key]);
        }
        location.reload();
      };
      reader.readAsText(file);
    }

    // –ü—Ä–∞–≤–∏–ª–æ –î–µ–Ω—å
    let currentRule = JSON.parse(localStorage.getItem('currentRule') || '{}');
    let customRules = JSON.parse(localStorage.getItem('customRules') || '[]');
    const defaultRules = [
      '–ù–µ –æ–ø—Ä–∞–≤–¥—ã–≤–∞–π—Å—è ‚Äî –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ ‚Äî —Å–ª–∞–±–æ—Å—Ç—å.',
      '–ï—Å–ª–∏ –Ω–µ –ø—Ä–∏–Ω–æ—Å–∏—Ç —Ä–µ—Å—É—Ä—Å ‚Äî –æ—Ç—Å–µ–∫–∞–π.',
      '–•–∏—â–Ω–∏–∫ –º–æ–ª—á–∏—Ç —á–∞—â–µ, —á–µ–º –≥–æ–≤–æ—Ä–∏—Ç.',
      '–ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–æ–±–æ–π ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –≤—Å–µ–º.',
      '–ö–∞–∂–¥–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ ‚Äî –≤–æ–π–Ω–∞ –∑–∞ –∏–Ω—Ç–µ—Ä–µ—Å—ã.',
      '–ì—Ä—É–±–æ—Å—Ç—å ‚Äî —Ñ–∏–ª—å—Ç—Ä. –ö—Ç–æ —Å–ª–∞–± ‚Äî –æ—Ç–ø–∞–¥—ë—Ç —Å–∞–º.',
      '–°–Ω–∞—á–∞–ª–∞ –¥–æ–º–∏–Ω–∏—Ä—É–π, –ø–æ—Ç–æ–º –¥—Ä—É–∂–∏.',
      '–ï—Å–ª–∏ –Ω–µ –¥–∞–≤—è—Ç –Ω–∞ —Ç–µ–±—è ‚Äî –¥–∞–≤–∏ —Ç—ã.',
      '–õ–æ–∂—å ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –Ω–µ —Å–ª–∞–±–æ—Å—Ç—å.',
      '–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ ‚â† –≤—ã–≥–æ–¥–Ω–æ–µ. –í—ã–±–∏—Ä–∞–π –≤—ã–≥–æ–¥—É.'
    ];

    function updateRule() {
      const today = new Date().toDateString();
      if (!currentRule.date || currentRule.date !== today) {
        const rule = customRules.length > 0 && Math.random() > 0.5
          ? customRules[Math.floor(Math.random() * customRules.length)]
          : defaultRules[Math.floor(Math.random() * defaultRules.length)];
        currentRule = { text: rule, adhered: 0, violated: 0, date: today };
        localStorage.setItem('currentRule', JSON.stringify(currentRule));
      }
      document.getElementById('rule-text').textContent = `${currentRule.text || '–ü—Ä–∞–≤–∏–ª–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ'} (–°–æ–±–ª—é–¥–µ–Ω–æ: ${currentRule.adhered || 0}, –ù–∞—Ä—É—à–µ–Ω–æ: ${currentRule.violated || 0})`;
    }

    function adhereRule() {
      if (currentRule.text) {
        currentRule.adhered = (currentRule.adhered || 0) + 1;
        localStorage.setItem('currentRule', JSON.stringify(currentRule));
        updateRule();
      } else {
        showError('rule', '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–æ');
      }
    }

    function violateRule() {
      if (currentRule.text) {
        currentRule.violated = (currentRule.violated || 0) + 1;
        localStorage.setItem('currentRule', JSON.stringify(currentRule));
        updateRule();
      } else {
        showError('rule', '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–æ');
      }
    }

    function addCustomRule() {
      const rule = document.getElementById('custom-rule').value.trim();
      if (rule) {
        customRules.push(rule);
        localStorage.setItem('customRules', JSON.stringify(customRules));
        document.getElementById('custom-rule').value = '';
        updateRule();
      } else {
        showError('rule', '–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–æ');
      }
    }

    // –ü–ª–∞–Ω –Ω–∞ –î–µ–Ω—å
    let plans = JSON.parse(localStorage.getItem('plans') || '[]');

    function renderPlans() {
      const planList = document.getElementById('plan-list');
      planList.innerHTML = '';
      plans.forEach((plan, index) => {
        const li = document.createElement('li');
        li.innerHTML = `${plan.text} <button onclick="deletePlan(${index})">‚ùå</button>`;
        planList.appendChild(li);
      });
    }

    function addPlan() {
      const text = document.getElementById('plan-text').value.trim();
      if (text) {
        plans.push({ text, created: new Date().toISOString() });
        localStorage.setItem('plans', JSON.stringify(plans));
        document.getElementById('plan-text').value = '';
        renderPlans();
      } else {
        showError('plan', '–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞—á—É');
      }
    }

    function deletePlan(index) {
      plans.splice(index, 1);
      localStorage.setItem('plans', JSON.stringify(plans));
      renderPlans();
    }

    // –û–∫—Ä—É–∂–µ–Ω–∏–µ
    let people = JSON.parse(localStorage.getItem('people') || '[]');

    function renderPeople() {
      const peopleList = document.getElementById('people-list');
      peopleList.innerHTML = '';
      people.forEach((person, index) => {
        const div = document.createElement('div');
        div.innerHTML = `${person.name} (${person.status}) [${person.tags.join(', ')}] <button onclick="deletePerson(${index})">‚ùå</button>`;
        peopleList.appendChild(div);
      });
    }

    function openPersonModal() { openModal('person-modal-template', 'person-modal'); }

    function addPerson() {
      const name = document.getElementById('person-name').value.trim();
      const status = document.getElementById('person-status').value;
      const tagsInput = document.getElementById('person-tags').value.trim();
      const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag) : [];
      if (name) {
        people.push({ name, status, tags });
        localStorage.setItem('people', JSON.stringify(people));
        document.getElementById('person-name').value = '';
        document.getElementById('person-status').value = 'neutral';
        document.getElementById('person-tags').value = '';
        renderPeople();
        closeModal('person-modal');
      } else {
        alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è');
      }
    }

    function deletePerson(index) {
      people.splice(index, 1);
      localStorage.setItem('people', JSON.stringify(people));
      renderPeople();
    }

    // –§–∏–Ω–∞–Ω—Å—ã
    let transactions = JSON.parse(localStorage.getItem('transactions') || '[]');

    function renderTransactions() {
      const financeList = document.getElementById('finance-list');
      financeList.innerHTML = '';
      transactions.forEach((transaction, index) => {
        const li = document.createElement('li');
        li.innerHTML = `${transaction.amount} (${transaction.type}) <button onclick="deleteTransaction(${index})">‚ùå</button>`;
        financeList.appendChild(li);
      });
      updateFinanceStats();
    }

    function addTransaction() {
      const amount = parseFloat(document.getElementById('finance-amount').value);
      const type = document.getElementById('finance-type').value;
      if (!isNaN(amount) && amount > 0) {
        transactions.push({ amount, type, date: new Date().toISOString() });
        localStorage.setItem('transactions', JSON.stringify(transactions));
        document.getElementById('finance-amount').value = '';
        document.getElementById('finance-type').value = 'income';
        renderTransactions();
      } else {
        showError('finance', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É');
      }
    }

    function deleteTransaction(index) {
      transactions.splice(index, 1);
      localStorage.setItem('transactions', JSON.stringify(transactions));
      renderTransactions();
    }

    function updateFinanceStats() {
      const incomes = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
      const expenses = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
      const balance = incomes - expenses;
      document.getElementById('finance-stats').textContent = `–î–æ—Ö–æ–¥—ã: ${incomes}, –†–∞—Å—Ö–æ–¥—ã: ${expenses}, –ë–∞–ª–∞–Ω—Å: ${balance}`;
    }

// –ü—Ä–∏–≤—ã—á–∫–∏
    let habits = JSON.parse(localStorage.getItem('habits') || '[]');

    function renderHabits() {
      const habitList = document.getElementById('habit-list');
      habitList.innerHTML = '';
      habits.forEach((habit, index) => {
        const li = document.createElement('li');
        li.innerHTML = `${habit.text} (${habit.frequency}) <button onclick="deleteHabit(${index})">‚ùå</button>`;
        habitList.appendChild(li);
      });
    }

    function addHabit() {
      const text = document.getElementById('habit-text').value.trim();
      const frequency = document.getElementById('habit-frequency').value;
      if (text) {
        habits.push({ text, frequency });
        localStorage.setItem('habits', JSON.stringify(habits));
        document.getElementById('habit-text').value = '';
        document.getElementById('habit-frequency').value = 'daily';
        renderHabits();
      } else {
        showError('habits', '–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–≤—ã—á–∫—É');
      }
    }

    function deleteHabit(index) {
      habits.splice(index, 1);
      localStorage.setItem('habits', JSON.stringify(habits));
      renderHabits();
    }

    // –ó–∞–º–µ—Ç–∫–∏
    let notes = JSON.parse(localStorage.getItem('notes') || '[]');

    function renderNotes() {
      const noteList = document.getElementById('note-list');
      noteList.innerHTML = '';
      notes.forEach((note, index) => {
        const li = document.createElement('li');
        li.innerHTML = `${note.text} (${new Date(note.date).toLocaleDateString()}) <button onclick="deleteNote(${index})">‚ùå</button>`;
        noteList.appendChild(li);
      });
    }

    function addNote() {
      const text = document.getElementById('note-text').value.trim();
      if (text) {
        notes.push({ text, date: new Date().toISOString() });
        localStorage.setItem('notes', JSON.stringify(notes));
        document.getElementById('note-text').value = '';
        renderNotes();
      } else {
        showError('notes', '–í–≤–µ–¥–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É');
      }
    }

    function deleteNote(index) {
      notes.splice(index, 1);
      localStorage.setItem('notes', JSON.stringify(notes));
      renderNotes();
    }

    // –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
    let knowledge = JSON.parse(localStorage.getItem('knowledge') || '[]');

    function renderKnowledge() {
      const knowledgeList = document.getElementById('knowledge-list');
      const searchTerm = document.getElementById('knowledge-search').value.toLowerCase();
      knowledgeList.innerHTML = '';
      knowledge.filter(note => note.title.toLowerCase().includes(searchTerm)).forEach((note, index) => {
        const li = document.createElement('li');
        li.innerHTML = `${note.title} <button onclick="deleteKnowledge(${index})">‚ùå</button>`;
        knowledgeList.appendChild(li);
      });
    }

    function openKnowledgeModal() { openModal('knowledge-modal-template', 'knowledge-modal'); }

    function addKnowledge() {
      const title = document.getElementById('knowledge-title').value.trim();
      const content = document.getElementById('knowledge-content').value.trim();
      if (title && content) {
        knowledge.push({ title, content, date: new Date().toISOString() });
        localStorage.setItem('knowledge', JSON.stringify(knowledge));
        document.getElementById('knowledge-title').value = '';
        document.getElementById('knowledge-content').value = '';
        renderKnowledge();
        closeModal('knowledge-modal');
      } else {
        alert('–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ');
      }
    }

    function deleteKnowledge(index) {
      knowledge.splice(index, 1);
      localStorage.setItem('knowledge', JSON.stringify(knowledge));
      renderKnowledge();
    }

    // –ê—Ä—Ö–µ—Ç–∏–ø—ã
    let archetype = JSON.parse(localStorage.getItem('archetype') || '{}');
    const archetypes = { predator: '–•–∏—â–Ω–∏–∫', strategist: '–°—Ç—Ä–∞—Ç–µ–≥', provocateur: '–ü—Ä–æ–≤–æ–∫–∞—Ç–æ—Ä' };

    function openArchetypeModal() { openModal('archetype-modal-template', 'archetype-modal'); }

    function submitArchetype() {
      const result = document.getElementById('archetype-question').value;
      archetype = { type: result };
      localStorage.setItem('archetype', JSON.stringify(archetype));
      document.getElementById('archetype-result').textContent = `–í–∞—à –∞—Ä—Ö–µ—Ç–∏–ø: ${archetypes[result]}`;
      closeModal('archetype-modal');
    }

    // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
    function accessAnalytics() {
      const totalPlans = plans.length;
      const totalTransactions = transactions.length;
      document.getElementById('analytics-results').textContent = `–í—Å–µ–≥–æ –∑–∞–¥–∞—á: ${totalPlans}, –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: ${totalTransactions}`;
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    function applyState() {
      const state = document.getElementById('state-select').value;
      localStorage.setItem('userState', state);
    }

    // –°–ø—Ä–∞–≤–∫–∞
    document.getElementById('help-content').innerHTML = '<h3>–°–ø—Ä–∞–≤–∫–∞</h3><p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–¥—É–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏, –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º –∏ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>';

    // –ö–∞—Ä—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    let strategies = JSON.parse(localStorage.getItem('strategies') || '[]');

    function renderStrategies() {
      const strategyList = document.getElementById('strategy-list');
      strategyList.innerHTML = '';
      strategies.forEach((strategy, index) => {
        const div = document.createElement('div');
        div.innerHTML = `${strategy.goal} <button onclick="deleteStrategy(${index})">‚ùå</button>`;
        strategyList.appendChild(div);
      });
    }

    function openStrategyModal() { openModal('strategy-modal-template', 'strategy-modal'); }

    function addStrategy() {
      const goal = document.getElementById('strategy-goal').value.trim();
      if (goal) {
        strategies.push({ goal, date: new Date().toISOString() });
        localStorage.setItem('strategies', JSON.stringify(strategies));
        document.getElementById('strategy-goal').value = '';
        renderStrategies();
        closeModal('strategy-modal');
      } else {
        alert('–í–≤–µ–¥–∏—Ç–µ —Ü–µ–ª—å');
      }
    }

    function deleteStrategy(index) {
      strategies.splice(index, 1);
      localStorage.setItem('strategies', JSON.stringify(strategies));
      renderStrategies();
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', () => {
      updateRule();
      renderPlans();
      renderPeople();
      renderTransactions();
      renderHabits();
      renderNotes();
      renderKnowledge();
      renderStrategies();
      if (archetype.type) document.getElementById('archetype-result').textContent = `–í–∞—à –∞—Ä—Ö–µ—Ç–∏–ø: ${archetypes[archetype.type]}`;
      accessAnalytics();
    });
  </script>
</body>
</html>